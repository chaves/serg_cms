import{r as z,z as M,aB as K,aC as J,j as e,b7 as U,G as F,e4 as x,bS as X,bT as V,Q as S,Y as g,e5 as ee,cO as y,e6 as te,U as D,e7 as ae,e8 as se,N as E,e9 as ne,ea as ie,Z as re,_ as oe,B as le,a4 as de,A as ce,u as ue,eb as me,C as ge,ec as he,ch as fe,b as pe,E as xe,ed as je,P as G,K as w,dl as be,ee as Ce,M as Re,ef as W,eg as C,eh as ze,dW as L,n as k,ei as Me,ej as Te,ek as ye,V as B,b1 as Se,cP as ve,W as we}from"./strapi-Bqijykrh.js";import{t as Le,a as De,R as Ee,z as ke}from"./schemas-ggMFyPwW.js";import{f as Ae}from"./index-CmrwhCa2.js";import{f as Ie}from"./index-CNZQXXUZ.js";function Pe(o,a,m){var s=Le(o,m),n=De(a,s,!0),t=new Date(s.getTime()-n),u=new Date(0);return u.setFullYear(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()),u.setHours(t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds()),u}const Ne=["years","months","days","hours","minutes","seconds"],$e=z.forwardRef(({timestamp:o,customIntervals:a=[],...m},s)=>{const{formatRelativeTime:n,formatDate:t,formatTime:u}=M(),r=K({start:o,end:Date.now()}),h=Ne.find(i=>r[i]>0&&Object.keys(r).includes(i)),d=J(o)?-r[h]:r[h],p=a.find(i=>r[i.unit]<i.threshold),j=p?p.text:n(d,h,{numeric:"auto"});return e.jsx("time",{ref:s,dateTime:o.toISOString(),role:"time",title:`${t(o)} ${u(o)}`,...m,children:j})}),Be=({handleClose:o,open:a,handleSubmit:m,initialValues:s,isLoading:n=!1})=>{const{formatMessage:t}=M(),{pathname:u}=U(),r=u===`/plugins/${ne}`,{timezoneList:h,systemTimezone:d={value:"UTC+00:00-Africa/Abidjan "}}=F(s.scheduledAt?new Date(s.scheduledAt):new Date),p=i=>{const{date:c,time:b,timezone:l}=i;if(!c||!b||!l)return null;const f=l.split("&")[1];return ke(`${c} ${b}`,f)},j=()=>h.find(c=>c.value.split("&")[1]===s.timezone)?.value||d.value;return e.jsx(x.Root,{open:a,onOpenChange:o,children:e.jsxs(x.Content,{children:[e.jsx(x.Header,{children:e.jsx(x.Title,{children:t({id:"content-releases.modal.title",defaultMessage:"{isCreatingRelease, select, true {New release} other {Edit release}}"},{isCreatingRelease:r})})}),e.jsx(X,{onSubmit:i=>{m({...i,timezone:i.timezone?i.timezone.split("&")[1]:null,scheduledAt:i.isScheduled?p(i):null})},initialValues:{...s,timezone:s.timezone?j():d.value},validationSchema:Ee,validateOnChange:!1,children:({values:i,errors:c,handleChange:b,setFieldValue:l})=>e.jsxs(V,{children:[e.jsx(x.Body,{children:e.jsxs(S,{direction:"column",alignItems:"stretch",gap:6,children:[e.jsxs(g.Root,{name:"name",error:c.name&&t({id:c.name,defaultMessage:c.name}),required:!0,children:[e.jsx(g.Label,{children:t({id:"content-releases.modal.form.input.label.release-name",defaultMessage:"Name"})}),e.jsx(ee,{type:"text",value:i.name,onChange:b}),e.jsx(g.Error,{})]}),e.jsx(y,{width:"max-content",children:e.jsx(te,{name:"isScheduled",checked:i.isScheduled,onCheckedChange:f=>{l("isScheduled",f),f?(l("date",s.date),l("time",s.time),l("timezone",s.timezone??d?.value)):(l("date",null),l("time",""),l("timezone",null))},children:e.jsx(D,{textColor:i.isScheduled?"primary600":"neutral800",fontWeight:i.isScheduled?"semiBold":"regular",children:t({id:"modal.form.input.label.schedule-release",defaultMessage:"Schedule release"})})})}),i.isScheduled&&e.jsxs(e.Fragment,{children:[e.jsxs(S,{gap:4,alignItems:"start",direction:{initial:"column",medium:"row"},wrap:"wrap",children:[e.jsx(y,{width:"100%",flex:1,children:e.jsxs(g.Root,{name:"date",error:c.date&&t({id:c.date,defaultMessage:c.date}),required:!0,children:[e.jsx(g.Label,{children:t({id:"content-releases.modal.form.input.label.date",defaultMessage:"Date"})}),e.jsx(ae,{onChange:f=>{const v=f?Ae(f,{representation:"date"}):null;l("date",v)},clearLabel:t({id:"content-releases.modal.form.input.clearLabel",defaultMessage:"Clear"}),onClear:()=>{l("date",null)},value:i.date?new Date(i.date):new Date,minDate:Pe(new Date,i.timezone.split("&")[1])}),e.jsx(g.Error,{})]})}),e.jsx(y,{width:"100%",flex:1,children:e.jsxs(g.Root,{name:"time",error:c.time&&t({id:c.time,defaultMessage:c.time}),required:!0,children:[e.jsx(g.Label,{children:t({id:"content-releases.modal.form.input.label.time",defaultMessage:"Time"})}),e.jsx(se,{onChange:f=>{l("time",f)},clearLabel:t({id:"content-releases.modal.form.input.clearLabel",defaultMessage:"Clear"}),onClear:()=>{l("time","")},value:i.time||void 0}),e.jsx(g.Error,{})]})})]}),e.jsx(Oe,{timezoneOptions:h})]})]})}),e.jsxs(x.Footer,{children:[e.jsx(x.Close,{children:e.jsx(E,{variant:"tertiary",name:"cancel",children:t({id:"cancel",defaultMessage:"Cancel"})})}),e.jsx(E,{name:"submit",loading:n,type:"submit",children:t({id:"content-releases.modal.form.button.submit",defaultMessage:"{isCreatingRelease, select, true {Continue} other {Save}}"},{isCreatingRelease:r})})]})]})})]})})},Oe=({timezoneOptions:o})=>{const{values:a,errors:m,setFieldValue:s}=ie(),{formatMessage:n}=M(),[t,u]=z.useState(o);return z.useEffect(()=>{if(a.date){const{timezoneList:r}=F(new Date(a.date));u(r);const h=a.timezone&&r.find(d=>d.value.split("&")[1]===a.timezone.split("&")[1]);h&&s("timezone",h.value)}},[s,a.date,a.timezone]),e.jsxs(g.Root,{name:"timezone",error:m.timezone&&n({id:m.timezone,defaultMessage:m.timezone}),required:!0,children:[e.jsx(g.Label,{children:n({id:"content-releases.modal.form.input.label.timezone",defaultMessage:"Timezone"})}),e.jsx(re,{autocomplete:{type:"list",filter:"contains"},value:a.timezone||void 0,textValue:a.timezone?a.timezone.replace(/&/," "):void 0,onChange:r=>{s("timezone",r)},onTextValueChange:r=>{s("timezone",r)},onClear:()=>{s("timezone","")},children:t.map(r=>e.jsx(oe,{value:r.value,children:r.value.replace(/&/," ")},r.value))}),e.jsx(g.Error,{})]})},Ue=k(W)`
  display: block;
`,Fe=k($e)`
  display: inline-block;
  &::first-letter {
    text-transform: uppercase;
  }
`,Ge=o=>{let a;switch(o){case"ready":a="success";break;case"blocked":a="warning";break;case"failed":a="danger";break;case"done":a="primary";break;case"empty":default:a="neutral"}return{textColor:`${a}600`,backgroundColor:`${a}100`,borderColor:`${a}200`}},O=({sectionTitle:o,releases:a=[],isError:m=!1})=>{const{formatMessage:s}=M();return m?e.jsx(G.Error,{}):a?.length===0?e.jsx(Te,{content:s({id:"content-releases.page.Releases.tab.emptyEntries",defaultMessage:"No releases"},{target:o}),icon:e.jsx(ye,{width:"16rem"})}):e.jsx(B.Root,{gap:4,children:a.map(({id:n,name:t,scheduledAt:u,status:r})=>e.jsx(B.Item,{col:3,s:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(Ue,{tag:Se,to:`${n}`,isExternal:!1,children:e.jsxs(S,{direction:"column",justifyContent:"space-between",padding:4,hasRadius:!0,background:"neutral0",shadow:"tableShadow",height:"100%",width:"100%",alignItems:"start",gap:4,children:[e.jsxs(S,{direction:"column",alignItems:"start",gap:1,children:[e.jsx(D,{textColor:"neutral800",tag:"h3",variant:"delta",fontWeight:"bold",children:t}),e.jsx(D,{variant:"pi",textColor:"neutral600",children:u?e.jsx(Fe,{timestamp:new Date(u)}):s({id:"content-releases.pages.Releases.not-scheduled",defaultMessage:"Not scheduled"})})]}),e.jsx(ve,{...Ge(r),children:r})]})})},n))})},We=k(Me)`
  button {
    display: none;
  }
  p + div {
    margin-left: auto;
  }
`,qe={name:"",date:Ie(new Date,"yyyy-MM-dd"),time:"",isScheduled:!0,scheduledAt:null,timezone:null},Ze=()=>{const o=U(),[a,m]=z.useState(!1),{toggleNotification:s}=le(),{formatMessage:n}=M(),t=de(),{formatAPIError:u}=ce(),[{query:r},h]=ue(),d=me(r),{data:p,isLoading:j}=ge(),[i,{isLoading:c}]=he(),{getFeature:b}=fe(),{maximumReleases:l=3}=b("cms-content-releases"),{trackUsage:f}=pe(),{allowedActions:{canCreate:v}}=xe(je),{isLoading:A,isSuccess:q,isError:I}=d,H=d?.currentData?.meta?.activeTab||"pending";z.useEffect(()=>{o?.state?.errors&&(s({type:"danger",title:n({id:"content-releases.pages.Releases.notification.error.title",defaultMessage:"Your request could not be processed."}),message:n({id:"content-releases.pages.Releases.notification.error.message",defaultMessage:"Please try again or open another release."})}),t("",{replace:!0,state:null}))},[n,o?.state?.errors,t,s]);const P=()=>{m(R=>!R)};if(A||j)return e.jsx(G.Loading,{});const N=q&&d.currentData?.meta?.pendingReleasesCount||0,$=N>=l,Q=R=>{h({...r,page:1,pageSize:d?.currentData?.meta?.pagination?.pageSize||16,filters:{releasedAt:{$notNull:R!=="pending"}}})},Y=async({name:R,scheduledAt:_,timezone:Z})=>{const T=await i({name:R,scheduledAt:_,timezone:Z});"data"in T?(s({type:"success",message:n({id:"content-releases.modal.release-created-notification-success",defaultMessage:"Release created."})}),f("didCreateRelease"),t(T.data.data.id.toString())):we(T.error)?s({type:"danger",message:u(T.error)}):s({type:"danger",message:n({id:"notification.error",defaultMessage:"An error occurred"})})};return e.jsx(w.Root,{children:e.jsxs(be,{"aria-busy":A||j,children:[e.jsx(w.Header,{title:n({id:"content-releases.pages.Releases.title",defaultMessage:"Releases"}),secondaryAction:e.jsx(Re,{label:n({id:"components.premiumFeature.title",defaultMessage:"Premium feature"})}),subtitle:n({id:"content-releases.pages.Releases.header-subtitle",defaultMessage:"Create and manage content updates"}),primaryAction:v?e.jsx(E,{startIcon:e.jsx(Ce,{}),onClick:P,disabled:$,children:n({id:"content-releases.header.actions.add-release",defaultMessage:"New release"})}):null}),e.jsx(w.Content,{children:e.jsxs(e.Fragment,{children:[$&&e.jsx(We,{marginBottom:6,action:e.jsx(W,{href:"https://strapi.io/pricing-cloud",isExternal:!0,children:n({id:"content-releases.pages.Releases.max-limit-reached.action",defaultMessage:"Explore plans"})}),title:n({id:"content-releases.pages.Releases.max-limit-reached.title",defaultMessage:"You have reached the {number} pending {number, plural, one {release} other {releases}} limit."},{number:l}),onClose:()=>{},closeLabel:"",children:n({id:"content-releases.pages.Releases.max-limit-reached.message",defaultMessage:"Upgrade to manage an unlimited number of releases."})}),e.jsxs(C.Root,{variant:"simple",onValueChange:Q,value:H,children:[e.jsxs(y,{paddingBottom:8,children:[e.jsxs(C.List,{"aria-label":n({id:"content-releases.pages.Releases.tab-group.label",defaultMessage:"Releases list"}),children:[e.jsx(C.Trigger,{value:"pending",children:n({id:"content-releases.pages.Releases.tab.pending",defaultMessage:"Pending ({count})"},{count:N})}),e.jsx(C.Trigger,{value:"done",children:n({id:"content-releases.pages.Releases.tab.done",defaultMessage:"Done"})})]}),e.jsx(ze,{})]}),e.jsx(C.Content,{value:"pending",children:e.jsx(O,{sectionTitle:"pending",releases:d?.currentData?.data,isError:I})}),e.jsx(C.Content,{value:"done",children:e.jsx(O,{sectionTitle:"done",releases:d?.currentData?.data,isError:I})})]}),e.jsxs(L.Root,{...d?.currentData?.meta?.pagination,defaultPageSize:d?.currentData?.meta?.pagination?.pageSize,children:[e.jsx(L.PageSize,{options:["8","16","32","64"]}),e.jsx(L.Links,{})]})]})}),e.jsx(Be,{open:a,handleClose:P,handleSubmit:Y,isLoading:c,initialValues:{...qe,timezone:p?.data.defaultTimezone?p.data.defaultTimezone.split("&")[1]:null}})]})})};export{$e as R,Be as a,Ze as b,Ge as g,Pe as u};
