import{md as Ge,me as Ve,mf as G,mg as ee,mh as We,mi as ze,el as D,d1 as Ke,r as f,j as e,bw as Ye,n as U,f7 as Ze,gM as Q,cY as oe,cy as Je,ff as Xe,mj as es,mk as ss,ml as ts,mm as rs,cr as ce,fg as ns,mn as is,i2 as V,mo as as,cB as os,d5 as se,d0 as O,bo as cs,bq as te,br as re,B,cZ as I,A as le,P as v,d2 as w,a4 as de,b as ue,d4 as W,bS as he,bT as ge,K as P,bU as me,b3 as ls,d3 as pe,b1 as fe,u as ds,E as us,ca as hs,$ as gs,a0 as H}from"./strapi-Bqijykrh.js";import{b as k,u as E,c as y,T as b,q as ne,G as S,V as be,r as ms,A as T,B as xe,F as je,d as R,f as ye,s as ve,m as ps,k as Re,n as $,o as fs,I as bs,t as xs,L as js,a as ys,v as vs,h as Rs,w as Cs,x as Ms,i as Ss,j as Os,l as N,E as ws,D as ks}from"./index-CgFZ7_N4.js";import{P as x}from"./index-BBfudWnT.js";import{s as ie}from"./sortBy-BtFMPpU2.js";import{t as Es,m as Ps}from"./tail-DGDVVepu.js";import{S as As}from"./SearchInput-7XxRjv8R.js";import"./_baseMap-DhmARHhS.js";import"./_baseEach-Bq7_pUyV.js";var Ls=function(s){Ge(t,s);function t(n,a){var r;return r=s.call(this)||this,r.client=n,r.queries=[],r.result=[],r.observers=[],r.observersMap={},a&&r.setQueries(a),r}var i=t.prototype;return i.onSubscribe=function(){var a=this;this.listeners.length===1&&this.observers.forEach(function(r){r.subscribe(function(o){a.onUpdate(r,o)})})},i.onUnsubscribe=function(){this.listeners.length||this.destroy()},i.destroy=function(){this.listeners=[],this.observers.forEach(function(a){a.destroy()})},i.setQueries=function(a,r){this.queries=a,this.updateObservers(r)},i.getCurrentResult=function(){return this.result},i.getOptimisticResult=function(a){return this.findMatchingObservers(a).map(function(r){return r.observer.getOptimisticResult(r.defaultedQueryOptions)})},i.findMatchingObservers=function(a){var r=this,o=this.observers,l=a.map(function(h){return r.client.defaultQueryObserverOptions(h)}),d=l.flatMap(function(h){var j=o.find(function(C){return C.options.queryHash===h.queryHash});return j!=null?[{defaultedQueryOptions:h,observer:j}]:[]}),m=d.map(function(h){return h.defaultedQueryOptions.queryHash}),g=l.filter(function(h){return!m.includes(h.queryHash)}),u=o.filter(function(h){return!d.some(function(j){return j.observer===h})}),c=g.map(function(h,j){if(h.keepPreviousData){var C=u[j];if(C!==void 0)return{defaultedQueryOptions:h,observer:C}}return{defaultedQueryOptions:h,observer:r.getObserver(h)}}),p=function(j,C){return l.indexOf(j.defaultedQueryOptions)-l.indexOf(C.defaultedQueryOptions)};return d.concat(c).sort(p)},i.getObserver=function(a){var r=this.client.defaultQueryObserverOptions(a),o=this.observersMap[r.queryHash];return o??new Ve(this.client,r)},i.updateObservers=function(a){var r=this;G.batch(function(){var o=r.observers,l=r.findMatchingObservers(r.queries);l.forEach(function(c){return c.observer.setOptions(c.defaultedQueryOptions,a)});var d=l.map(function(c){return c.observer}),m=Object.fromEntries(d.map(function(c){return[c.options.queryHash,c]})),g=d.map(function(c){return c.getCurrentResult()}),u=d.some(function(c,p){return c!==o[p]});o.length===d.length&&!u||(r.observers=d,r.observersMap=m,r.result=g,r.hasListeners()&&(ee(o,d).forEach(function(c){c.destroy()}),ee(d,o).forEach(function(c){c.subscribe(function(p){r.onUpdate(c,p)})}),r.notify()))})},i.onUpdate=function(a,r){var o=this.observers.indexOf(a);o!==-1&&(this.result=We(this.result,o,r),this.notify())},i.notify=function(){var a=this;G.batch(function(){a.listeners.forEach(function(r){r(a.result)})})},t}(ze);function Ds(s){var t=D.useRef(!1),i=D.useState(0),n=i[1],a=Ke(),r=f.useMemo(function(){return s.map(function(m){var g=a.defaultQueryObserverOptions(m);return g.optimisticResults=!0,g})},[s,a]),o=D.useState(function(){return new Ls(a,r)}),l=o[0],d=l.getOptimisticResult(r);return D.useEffect(function(){t.current=!0;var m=l.subscribe(G.batchCalls(function(){t.current&&n(function(g){return g+1})}));return function(){t.current=!1,m()}},[l]),D.useEffect(function(){l.setQueries(r,{listeners:!1})},[r,l]),d}const Ce=f.createContext({}),Me=({children:s,value:t})=>e.jsx(Ce.Provider,{value:t,children:s}),z=()=>f.useContext(Ce);Me.propTypes={children:x.node.isRequired,value:x.object.isRequired};function Ts(s){switch(s){case"application":return"Application";case"plugin::content-manager":return"Content manager";case"plugin::content-type-builder":return"Content types builder";case"plugin::documentation":return"Documentation";case"plugin::email":return"Email";case"plugin::i18n":return"i18n";case"plugin::upload":return"Media Library";case"plugin::users-permissions":return"Users-permissions";default:return Ye(s.replace("api::","").replace("plugin::",""))}}const Is=(s,t)=>{const i=Object.keys(t).sort().map(n=>({name:n,isOpen:!1}));return{...s,collapses:i}},ae=Ze`
  background: ${s=>s.theme.colors.primary100};

  #cog {
    opacity: 1;
  }
`,_s=U(k)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  #cog {
    opacity: 0;
    path {
      fill: ${s=>s.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${s=>s.isActive&&ae}
  &:hover {
    ${ae}
  }
`,qs=U.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:s})=>s.colors.neutral150};
`,Se=({subCategory:s})=>{const{formatMessage:t}=E(),{onChange:i,onChangeSelectAll:n,onSelectedAction:a,selectedAction:r,modifiedData:o}=z(),l=f.useMemo(()=>Q(o,s.name,{}),[o,s]),d=f.useMemo(()=>Object.values(l).every(c=>c.enabled===!0),[l]),m=f.useMemo(()=>Object.values(l).some(c=>c.enabled===!0)&&!d,[l,d]),g=f.useCallback(({target:{name:c}})=>{n({target:{name:c,value:!d}})},[d,n]),u=f.useCallback(c=>r===c,[r]);return e.jsxs(k,{children:[e.jsxs(y,{justifyContent:"space-between",alignItems:"center",children:[e.jsx(k,{paddingRight:4,children:e.jsx(b,{variant:"sigma",textColor:"neutral600",children:s.label})}),e.jsx(qs,{}),e.jsx(k,{paddingLeft:4,children:e.jsx(ne,{name:s.name,checked:m?"indeterminate":d,onCheckedChange:c=>g({target:{name:s.name,value:c}}),children:t({id:"app.utils.select-all",defaultMessage:"Select all"})})})]}),e.jsx(y,{paddingTop:6,paddingBottom:6,children:e.jsx(S.Root,{gap:2,style:{flex:1},children:s.actions.map(c=>{const p=`${c.name}.enabled`;return e.jsx(S.Item,{col:4,xs:12,s:6,direction:"column",alignItems:"stretch",children:e.jsxs(_s,{isActive:u(c.name),padding:2,hasRadius:!0,children:[e.jsx(ne,{checked:Q(o,p,!1),name:p,onCheckedChange:h=>i({target:{name:p,value:h}}),children:c.label}),e.jsxs("button",{type:"button",onClick:()=>a(c.name),style:{display:"inline-flex",alignItems:"center"},children:[e.jsx(be,{tag:"span",children:t({id:"app.utils.show-bound-route",defaultMessage:"Show bound route for {route}"},{route:c.name})}),e.jsx(ms,{id:"cog",cursor:"pointer"})]})]})},c.name)})})})]})};Se.propTypes={subCategory:x.object.isRequired};const Oe=({name:s,permissions:t})=>{const i=f.useMemo(()=>ie(Object.values(t.controllers).reduce((n,a,r)=>{const o=`${s}.controllers.${Object.keys(t.controllers)[r]}`,l=ie(Object.keys(a).reduce((d,m)=>[...d,{...a[m],label:m,name:`${o}.${m}`}],[]),"label");return[...n,{actions:l,label:Object.keys(t.controllers)[r],name:o}]},[]),"label"),[s,t]);return e.jsx(k,{padding:6,children:i.map(n=>e.jsx(Se,{subCategory:n},n.name))})};Oe.propTypes={name:x.string.isRequired,permissions:x.object.isRequired};const $s={collapses:[]},Ns=(s,t)=>oe(s,i=>{switch(t.type){case"TOGGLE_COLLAPSE":{i.collapses=s.collapses.map((n,a)=>a===t.index?{...n,isOpen:!n.isOpen}:{...n,isOpen:!1});break}default:return i}}),Qs=()=>{const{modifiedData:s}=z(),{formatMessage:t}=E(),[{collapses:i}]=f.useReducer(Ns,$s,n=>Is(n,s));return e.jsx(T.Root,{size:"M",children:e.jsx(y,{direction:"column",alignItems:"stretch",gap:1,children:i.map((n,a)=>e.jsxs(T.Item,{value:n.name,children:[e.jsx(T.Header,{variant:a%2===0?"secondary":void 0,children:e.jsx(T.Trigger,{caretPosition:"right",description:t({id:"users-permissions.Plugin.permissions.plugins.description",defaultMessage:"Define all allowed actions for the {name} plugin."},{name:n.name}),children:Ts(n.name)})}),e.jsx(T.Content,{children:e.jsx(Oe,{permissions:s[n.name],name:n.name})})]},n.name))})})};var Us=es,Bs=ss,Fs=ts,Hs=Je,Gs=Xe,Vs=rs,Ws=200;function zs(s,t,i,n){var a=-1,r=Bs,o=!0,l=s.length,d=[],m=t.length;if(!l)return d;i&&(t=Hs(t,Gs(i))),n?(r=Fs,o=!1):t.length>=Ws&&(r=Vs,o=!1,t=new Us(t));e:for(;++a<l;){var g=s[a],u=i==null?g:i(g);if(g=n||g!==0?g:0,o&&u===u){for(var c=m;c--;)if(t[c]===u)continue e;d.push(g)}else r(t,u,n)||d.push(g)}return d}var Ks=zs,Ys=Ks,Zs=ns,Js=is,Xs=Zs(function(s,t){return Js(s)?Ys(s,t):[]}),et=Xs;const st=ce(et),tt=s=>{switch(s){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},rt=U(k)`
  margin: -1px;
  border-radius: ${({theme:s})=>s.spaces[1]} 0 0 ${({theme:s})=>s.spaces[1]};
`;function K({route:s}){const{formatMessage:t}=E(),{method:i,handler:n,path:a}=s,r=a?Es(a.split("/")):[],[o="",l=""]=n?n.split("."):[],d=tt(s.method);return e.jsxs(y,{direction:"column",alignItems:"stretch",gap:2,children:[e.jsxs(b,{variant:"delta",tag:"h3",children:[t({id:"users-permissions.BoundRoute.title",defaultMessage:"Bound route to"}),"Â ",e.jsx("span",{children:o}),e.jsxs(b,{variant:"delta",textColor:"primary600",children:[".",l]})]}),e.jsxs(y,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0,children:[e.jsx(rt,{background:d.background,borderColor:d.border,padding:2,children:e.jsx(b,{fontWeight:"bold",textColor:d.text,children:i})}),e.jsx(k,{paddingLeft:2,paddingRight:2,children:Ps(r,m=>e.jsxs(b,{textColor:m.includes(":")?"neutral600":"neutral900",children:["/",m]},m))})]})]})}K.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}};K.propTypes={route:x.shape({handler:x.string,method:x.string,path:x.string})};const nt=()=>{const{formatMessage:s}=E(),{selectedAction:t,routes:i}=z(),n=st(t.split("."),"controllers"),a=Q(i,n[0]),r=n.slice(1).join("."),o=V(a)?[]:a.filter(l=>l.handler.endsWith(r));return e.jsx(S.Item,{col:5,xs:12,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"},direction:"column",alignItems:"stretch",children:t?e.jsx(y,{direction:"column",alignItems:"stretch",gap:2,children:o.map((l,d)=>e.jsx(K,{route:l},d))}):e.jsxs(y,{direction:"column",alignItems:"stretch",gap:2,children:[e.jsx(b,{variant:"delta",tag:"h3",children:s({id:"users-permissions.Policies.header.title",defaultMessage:"Advanced settings"})}),e.jsx(b,{tag:"p",textColor:"neutral600",children:s({id:"users-permissions.Policies.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"})})]})})},it=(s,t,i)=>({...s,initialData:t,modifiedData:t,routes:i});var at=os,ot=as;function ct(s,t,i){return s&&s.length?(t=i||t===void 0?1:ot(t),at(s,0,t<0?0:t)):[]}var lt=ct;const dt=ce(lt),ut={initialData:{},modifiedData:{},routes:{},selectedAction:"",policies:[]},ht=(s,t)=>oe(s,i=>{switch(t.type){case"ON_CHANGE":{const n=t.keys.length,a=t.keys[n-1]==="enabled";if(t.value&&a){const r=dt(t.keys,n-1).join(".");i.selectedAction=r}se(i,["modifiedData",...t.keys],t.value);break}case"ON_CHANGE_SELECT_ALL":{const n=["modifiedData",...t.keys],a=Q(s,n,{}),r=Object.keys(a).reduce((o,l)=>(o[l]={...a[l],enabled:t.value},o),{});se(i,n,r);break}case"ON_RESET":{i.modifiedData=s.initialData;break}case"ON_SUBMIT_SUCCEEDED":{i.initialData=s.modifiedData;break}case"SELECT_ACTION":{const{actionToSelect:n}=t;i.selectedAction=n===s.selectedAction?"":n;break}default:return i}}),we=f.forwardRef(({permissions:s,routes:t},i)=>{const{formatMessage:n}=E(),[a,r]=f.useReducer(ht,ut,g=>it(g,s,t));f.useImperativeHandle(i,()=>({getPermissions(){return{permissions:a.modifiedData}},resetForm(){r({type:"ON_RESET"})},setFormAfterSubmit(){r({type:"ON_SUBMIT_SUCCEEDED"})}}));const m={...a,onChange:({target:{name:g,value:u}})=>r({type:"ON_CHANGE",keys:g.split("."),value:u==="empty__string_value"?"":u}),onChangeSelectAll:({target:{name:g,value:u}})=>r({type:"ON_CHANGE_SELECT_ALL",keys:g.split("."),value:u}),onSelectedAction:g=>r({type:"SELECT_ACTION",actionToSelect:g})};return e.jsx(Me,{value:m,children:e.jsxs(S.Root,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0",children:[e.jsx(S.Item,{col:7,xs:12,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,direction:"column",alignItems:"stretch",children:e.jsxs(y,{direction:"column",alignItems:"stretch",gap:6,children:[e.jsxs(y,{direction:"column",alignItems:"stretch",gap:2,children:[e.jsx(b,{variant:"delta",tag:"h2",children:n({id:O("Plugins.header.title"),defaultMessage:"Permissions"})}),e.jsx(b,{tag:"p",textColor:"neutral600",children:n({id:O("Plugins.header.description"),defaultMessage:"Only actions bound by a route are listed below."})})]}),e.jsx(Qs,{})]})}),e.jsx(nt,{})]})})});we.propTypes={permissions:x.object.isRequired,routes:x.object.isRequired};var ke=f.memo(we);const Ee=cs().shape({name:te().required(re.required.id),description:te().required(re.required.id)}),gt=s=>Object.keys(s).reduce((t,i)=>{const n=s[i].controllers,a=Object.keys(n).reduce((r,o)=>(V(n[o])||(r[o]=n[o]),r),{});return V(a)||(t[i]={controllers:a}),t},{}),Pe=()=>{const{toggleNotification:s}=B(),{get:t}=I(),{formatAPIError:i}=le(O),[{data:n,isLoading:a,error:r,refetch:o},{data:l,isLoading:d,error:m,refetch:g}]=Ds([{queryKey:["users-permissions","permissions"],async queryFn(){const{data:{permissions:p}}=await t("/users-permissions/permissions");return p}},{queryKey:["users-permissions","routes"],async queryFn(){const{data:{routes:p}}=await t("/users-permissions/routes");return p}}]),u=async()=>{await Promise.all([o(),g()])};f.useEffect(()=>{r&&s({type:"danger",message:i(r)})},[s,r,i]),f.useEffect(()=>{m&&s({type:"danger",message:i(m)})},[s,m,i]);const c=a||d;return{permissions:n?gt(n):{},routes:l??{},getData:u,isLoading:c}},mt=()=>{const{formatMessage:s}=E(),{toggleNotification:t}=B(),i=de(),{isLoading:n,permissions:a,routes:r}=Pe(),{trackUsage:o}=ue(),l=f.useRef(),{post:d}=I(),m=W(u=>d("/users-permissions/roles",u),{onError(){t({type:"danger",message:s({id:"notification.error",defaultMessage:"An error occurred"})})},onSuccess(){o("didCreateRole"),t({type:"success",message:s({id:O("Settings.roles.created"),defaultMessage:"Role created"})}),i(-1)}}),g=async u=>{const c=l.current.getPermissions();await m.mutate({...u,...c,users:[]})};return e.jsxs(v.Main,{children:[e.jsx(v.Title,{children:s({id:"Settings.PageTitle",defaultMessage:"Settings - {name}"},{name:"Roles"})}),e.jsx(he,{enableReinitialize:!0,initialValues:{name:"",description:""},onSubmit:g,validationSchema:Ee,children:({handleSubmit:u,values:c,handleChange:p,errors:h})=>e.jsxs(ge,{noValidate:!0,onSubmit:u,children:[e.jsx(P.Header,{primaryAction:!n&&e.jsx(xe,{type:"submit",loading:m.isLoading,startIcon:e.jsx(je,{}),children:s({id:"global.save",defaultMessage:"Save"})}),title:s({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:s({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.jsx(k,{display:{initial:"none",medium:"block"},children:e.jsx(me,{fallback:".."})})}),e.jsx(P.Content,{children:e.jsxs(y,{background:"neutral0",direction:"column",alignItems:"stretch",gap:7,hasRadius:!0,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,shadow:"filterShadow",children:[e.jsxs(y,{direction:"column",alignItems:"stretch",children:[e.jsx(b,{variant:"delta",tag:"h2",children:s({id:O("EditPage.form.roles"),defaultMessage:"Role details"})}),e.jsxs(S.Root,{gap:4,children:[e.jsx(S.Item,{col:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsxs(R.Root,{name:"name",error:h?.name?s({id:h.name,defaultMessage:"Name is required"}):!1,required:!0,children:[e.jsx(R.Label,{children:s({id:"global.name",defaultMessage:"Name"})}),e.jsx(ye,{type:"text",value:c.name||"",onChange:p}),e.jsx(R.Error,{})]})}),e.jsx(S.Item,{col:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsxs(R.Root,{name:"description",error:h?.description?s({id:h.description,defaultMessage:"Description is required"}):!1,required:!0,children:[e.jsx(R.Label,{children:s({id:"global.description",defaultMessage:"Description"})}),e.jsx(ve,{value:c.description||"",onChange:p}),e.jsx(R.Error,{})]})})]})]}),!n&&e.jsx(ke,{ref:l,permissions:a,routes:r})]})})]})})]})},pt=()=>e.jsx(v.Protect,{permissions:w.createRole,children:e.jsx(mt,{})}),ft=()=>{const{formatMessage:s}=E(),{toggleNotification:t}=B(),{params:{id:i}}=ls("/settings/users-permissions/roles/:id"),{get:n}=I(),{isLoading:a,routes:r}=Pe(),{data:o,isLoading:l,refetch:d}=pe(["users-permissions","role",i],async()=>{const{data:{role:h}}=await n(`/users-permissions/roles/${i}`);return h}),m=f.useRef(),{put:g}=I(),{formatAPIError:u}=le(),c=W(h=>g(`/users-permissions/roles/${i}`,h),{onError(h){t({type:"danger",message:u(h)})},async onSuccess(){t({type:"success",message:s({id:O("Settings.roles.created"),defaultMessage:"Role edited"})}),await d()}}),p=async h=>{const j=m.current.getPermissions();await c.mutate({...h,...j,users:[]})};return l?e.jsx(v.Loading,{}):e.jsxs(v.Main,{children:[e.jsx(v.Title,{children:s({id:"Settings.PageTitle",defaultMessage:"Settings - {name}"},{name:"Roles"})}),e.jsx(he,{enableReinitialize:!0,initialValues:{name:o.name,description:o.description},onSubmit:p,validationSchema:Ee,children:({handleSubmit:h,values:j,handleChange:C,errors:A})=>e.jsxs(ge,{noValidate:!0,onSubmit:h,children:[e.jsx(P.Header,{primaryAction:a?null:e.jsx(xe,{disabled:o.code==="strapi-super-admin",type:"submit",loading:c.isLoading,startIcon:e.jsx(je,{}),children:s({id:"global.save",defaultMessage:"Save"})}),title:o.name,subtitle:o.description,navigationAction:e.jsx(k,{display:{initial:"none",medium:"block"},children:e.jsx(me,{fallback:".."})})}),e.jsx(P.Content,{children:e.jsxs(y,{background:"neutral0",direction:"column",alignItems:"stretch",gap:7,hasRadius:!0,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,shadow:"filterShadow",children:[e.jsxs(y,{direction:"column",alignItems:"stretch",gap:4,children:[e.jsx(b,{variant:"delta",tag:"h2",children:s({id:O("EditPage.form.roles"),defaultMessage:"Role details"})}),e.jsxs(S.Root,{gap:4,children:[e.jsx(S.Item,{col:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsxs(R.Root,{name:"name",error:A?.name?s({id:A.name,defaultMessage:"Name is required"}):!1,required:!0,children:[e.jsx(R.Label,{children:s({id:"global.name",defaultMessage:"Name"})}),e.jsx(ye,{type:"text",value:j.name||"",onChange:C}),e.jsx(R.Error,{})]})}),e.jsx(S.Item,{col:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsxs(R.Root,{name:"description",error:A?.description?s({id:A.description,defaultMessage:"Description is required"}):!1,required:!0,children:[e.jsx(R.Label,{children:s({id:"global.description",defaultMessage:"Description"})}),e.jsx(ve,{value:j.description||"",onChange:C}),e.jsx(R.Error,{})]})})]})]}),!a&&e.jsx(ke,{ref:m,permissions:o.permissions,routes:r})]})})]})})]})},bt=()=>e.jsx(v.Protect,{permissions:w.updateRole,children:e.jsx(ft,{})}),xt=U(js)`
  align-items: center;
  height: 3.2rem;
  width: 3.2rem;
  display: flex;
  justify-content: center;
  padding: ${({theme:s})=>`${s.spaces[2]}`};

  svg {
    height: 1.6rem;
    width: 1.6rem;

    path {
      fill: ${({theme:s})=>s.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:s})=>s.colors.neutral800};
      }
    }
  }
`,Y=({sortedRoles:s,canDelete:t,canUpdate:i,setRoleToDelete:n,onDelete:a})=>{const{formatMessage:r}=E(),o=de(),[l,d]=a,m=u=>t&&!["public","authenticated"].includes(u.type),g=u=>{n(u),d(!l)};return e.jsx(ps,{children:s?.map(u=>e.jsxs(Re,{cursor:"pointer",onClick:()=>o(u.id.toString()),children:[e.jsx($,{width:"20%",children:e.jsx(b,{children:u.name})}),e.jsx($,{width:"50%",children:e.jsx(b,{children:u.description})}),e.jsx($,{width:"30%",children:e.jsx(b,{children:r({id:"Roles.RoleRow.user-count",defaultMessage:"{number, plural, =0 {# user} one {# user} other {# users}}"},{number:u.nb_users})})}),e.jsx($,{children:e.jsxs(y,{justifyContent:"end",onClick:c=>c.stopPropagation(),children:[i?e.jsx(xt,{tag:fe,to:u.id.toString(),"aria-label":r({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:`${u.name}`}),children:e.jsx(fs,{})}):null,m(u)&&e.jsx(bs,{onClick:()=>g(u.id.toString()),variant:"ghost",label:r({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${u.name}`}),children:e.jsx(xs,{})})]})})]},u.name))})};Y.defaultProps={canDelete:!1,canUpdate:!1};Y.propTypes={onDelete:x.array.isRequired,setRoleToDelete:x.func.isRequired,sortedRoles:x.array.isRequired,canDelete:x.bool,canUpdate:x.bool};const jt=()=>{const{trackUsage:s}=ue(),{formatMessage:t,locale:i}=E(),{toggleNotification:n}=B(),{notifyStatus:a}=ys(),[{query:r}]=ds(),o=r?._q||"",[l,d]=f.useState(!1),[m,g]=f.useState(),{del:u,get:c}=I(),{isLoading:p,allowedActions:{canRead:h,canDelete:j,canCreate:C,canUpdate:A}}=us({create:w.createRole,read:w.readRoles,update:w.updateRole,delete:w.deleteRole}),{isLoading:Ae,data:{roles:Z},isFetching:Le,refetch:De}=pe("get-roles",()=>qe(n,t,a),{initialData:{},enabled:h}),{contains:J}=vs(i,{sensitivity:"base"}),X=Rs(i,{sensitivity:"base"}),Te=Ae||Le||p,Ie=()=>{d(!l)},_e=async(M,L,F)=>{try{await u(`/users-permissions/roles/${M}`)}catch{F({type:"danger",message:L({id:"notification.error",defaultMessage:"An error occured"})})}},qe=async(M,L,F)=>{try{const{data:q}=await c("/users-permissions/roles");return F("The roles have loaded successfully"),q}catch(q){throw M({type:"danger",message:L({id:"notification.error",defaultMessage:"An error occurred"})}),new Error(q)}},$e={roles:{id:O("Roles.empty"),defaultMessage:"You don't have any roles yet."},search:{id:O("Roles.empty.search"),defaultMessage:"No roles match the search."}},Ne=t({id:"global.roles",defaultMessage:"Roles"}),Qe=W(M=>_e(M,t,n),{async onSuccess(){await De()}}),Ue=async()=>{await Qe.mutateAsync(m),d(!l)},_=(Z||[]).filter(M=>J(M.name,o)||J(M.description,o)).sort((M,L)=>X.compare(M.name,L.name)||X.compare(M.description,L.description)),Be=o&&!_.length?"search":"roles",Fe=4,He=(Z?.length||0)+1;return Te?e.jsx(v.Loading,{}):e.jsxs(v.Main,{children:[e.jsx(v.Title,{children:t({id:"Settings.PageTitle",defaultMessage:"Settings - {name}"},{name:Ne})}),e.jsx(P.Header,{title:t({id:"global.roles",defaultMessage:"Roles"}),subtitle:t({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),primaryAction:C?e.jsx(Cs,{to:"new",tag:fe,onClick:()=>s("willCreateRole"),startIcon:e.jsx(Ms,{}),size:"S",children:t({id:O("List.button.roles"),defaultMessage:"Add new role"})}):null}),e.jsx(P.Action,{startActions:e.jsx(As,{label:t({id:"app.component.search.label",defaultMessage:"Search"})})}),e.jsxs(P.Content,{children:[!h&&e.jsx(v.NoPermissions,{}),h&&_&&_?.length?e.jsxs(Ss,{colCount:Fe,rowCount:He,children:[e.jsx(Os,{children:e.jsxs(Re,{children:[e.jsx(N,{children:e.jsx(b,{variant:"sigma",textColor:"neutral600",children:t({id:"global.name",defaultMessage:"Name"})})}),e.jsx(N,{children:e.jsx(b,{variant:"sigma",textColor:"neutral600",children:t({id:"global.description",defaultMessage:"Description"})})}),e.jsx(N,{children:e.jsx(b,{variant:"sigma",textColor:"neutral600",children:t({id:"global.users",defaultMessage:"Users"})})}),e.jsx(N,{children:e.jsx(be,{children:t({id:"global.actions",defaultMessage:"Actions"})})})]})}),e.jsx(Y,{sortedRoles:_,canDelete:j,canUpdate:A,permissions:w,setRoleToDelete:g,onDelete:[l,d]})]}):e.jsx(ws,{content:t($e[Be])})]}),e.jsx(ks.Root,{open:l,onOpenChange:Ie,children:e.jsx(hs,{onConfirm:Ue})})]})},yt=()=>e.jsx(v.Protect,{permissions:w.accessRoles,children:e.jsx(jt,{})}),Et=()=>e.jsx(v.Protect,{permissions:w.accessRoles,children:e.jsxs(gs,{children:[e.jsx(H,{index:!0,element:e.jsx(yt,{})}),e.jsx(H,{path:"new",element:e.jsx(pt,{})}),e.jsx(H,{path:":id",element:e.jsx(bt,{})})]})});export{Et as default};
