const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["MagicLinkEE-Dk1RXg1R.js","strapi-Bqijykrh.js","strapi-D6821bIJ.css","SelectRoles-0atMSo0U.js","useAdminRoles-BIGJKjiw.js"])))=>i.map(i=>d[i]);
import{bk as T,j as e,P as m,a as C,b3 as B,a4 as z,B as D,bW as q,a1 as F,A as O,E as V,bX as N,bY as H,r as K,bZ as w,J as Y,bo as $,K as y,au as l,bU as G,bi as J,bp as Q,v as h,x as P,bu as c,bv as W,bC as X,bE as Z,br as v,bt as ee}from"./strapi-Bqijykrh.js";import{s as se}from"./selectors-BnJm7gXF.js";import{g as ae}from"./users-DLc-PG84.js";import{M as te,S as re}from"./SelectRoles-0atMSo0U.js";import{C as ie}from"./validation-oKOQMn2X.js";import"./useAdminRoles-BIGJKjiw.js";const oe=$().shape({...ie,isActive:Z(),roles:X().min(1,{id:v.required.id,defaultMessage:"This field is required"}).required({id:v.required.id,defaultMessage:"This field is required"})}),L=["email","firstname","lastname","username","isActive","roles"],ne=()=>{const{formatMessage:s}=C(),b=B("/settings/users/:id")?.params?.id??"",x=z(),{toggleNotification:r}=D(),M=q(te,async()=>(await F(async()=>{const{MagicLinkEE:a}=await import("./MagicLinkEE-Dk1RXg1R.js");return{MagicLinkEE:a}},__vite__mapDeps([0,1,2,3,4]))).MagicLinkEE),{_unstableFormatAPIError:u,_unstableFormatValidationErrors:k}=O(),A=T(se),{isLoading:I,allowedActions:{canUpdate:g}}=V({read:A.settings?.users.read??[],update:A.settings?.users.update??[]}),[U]=N(),{data:_,error:i,isLoading:R}=H({id:b},{refetchOnMountOrArgChange:!0}),[o]=_?.users??[];if(K.useEffect(()=>{i&&(i.name==="UnauthorizedError"?(r({type:"info",message:s({id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"})}),x("/")):r({type:"danger",message:u(i)}))},[i,u,s,x,r]),R||!M||I)return e.jsx(m.Loading,{});const E={...w(o,L),roles:o.roles.map(({id:a})=>a),password:"",confirmPassword:""},S=async(a,n)=>{const{confirmPassword:j,...p}=a,t=await U({id:b,...p});"error"in t&&ee(t.error)?(t.error.name==="ValidationError"&&n.setErrors(k(t.error)),r({type:"danger",message:u(t.error)})):(r({type:"success",message:s({id:"notification.success.saved",defaultMessage:"Saved"})}),n.setValues({...w(a,L),password:"",confirmPassword:""}))};return e.jsxs(m.Main,{children:[e.jsx(m.Title,{children:s({id:"Settings.PageTitle",defaultMessage:"Settings - {name}"},{name:"Users"})}),e.jsx(Y,{method:"PUT",onSubmit:S,initialValues:E,validationSchema:oe,children:({isSubmitting:a,modified:n})=>e.jsxs(e.Fragment,{children:[e.jsx(y.Header,{primaryAction:e.jsx(J,{disabled:a||!g||!n,startIcon:e.jsx(Q,{}),loading:a,type:"submit",children:s({id:"global.save",defaultMessage:"Save"})}),title:s({id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},{name:ae(E)}),navigationAction:e.jsx(l,{display:{initial:"none",medium:"block"},children:e.jsx(G,{fallback:"../users"})})}),e.jsxs(y.Content,{children:[o?.registrationToken&&e.jsx(l,{paddingBottom:6,children:e.jsx(M,{registrationToken:o.registrationToken})}),e.jsxs(h,{direction:"column",alignItems:"stretch",gap:7,children:[e.jsx(l,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:e.jsxs(h,{direction:"column",alignItems:"stretch",gap:4,children:[e.jsx(P,{variant:"delta",tag:"h2",children:s({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})}),e.jsx(c.Root,{gap:5,children:de.map(j=>j.map(({size:p,label:t,...d})=>e.jsx(c.Item,{m:p,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(W,{...d,disabled:!g,label:s(t),placeholder:"placeholder"in d?s(d.placeholder):void 0})},d.name)))})]})}),e.jsx(l,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:e.jsxs(h,{direction:"column",alignItems:"stretch",gap:4,children:[e.jsx(P,{variant:"delta",tag:"h2",children:s({id:"global.roles",defaultMessage:"User's role"})}),e.jsx(c.Root,{gap:5,children:e.jsx(c.Item,{col:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(re,{disabled:!g})})})]})})]})]})]})})]})},de=[[{label:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"string",size:6,required:!0},{label:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"string",size:6}],[{label:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:6,required:!0},{label:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"string",size:6}],[{autoComplete:"new-password",label:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:6},{autoComplete:"new-password",label:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:6}],[{label:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"boolean",size:6}]],fe=()=>{const s=T(f=>f.admin_app.permissions.settings?.users.read);return e.jsx(m.Protect,{permissions:s,children:e.jsx(ne,{})})};export{ne as EditPage,fe as ProtectedEditPage};
