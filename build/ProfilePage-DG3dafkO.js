import{e as Q,bk as f,a as u,b as $,B as G,bl as J,b4 as K,A as Y,ah as W,r as S,bm as X,bn as Z,j as e,P as g,J as ee,bo as se,K as P,bi as ae,bp as re,au as h,v as b,bq as I,br as te,bs as ie,bt as T,x as m,bu as l,bv as x,bw as oe}from"./strapi-CDBlFoOX.js";import{g as ne}from"./users-DLc-PG84.js";import{C as le}from"./validation-C1vtGWgj.js";const de=se().shape({...le,currentPassword:I().when(["password","confirmPassword"],(r,s,a)=>r||s?a.required({id:te.required.id,defaultMessage:"This field is required"}).nullable():a),preferedLanguage:I().nullable()}),w=({children:r,...s})=>e.jsx(h,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:e.jsx(b,{direction:"column",alignItems:"stretch",gap:4,...s,children:r})}),we=()=>{const r=Q(),s=f(o=>o.admin_app.language.localeNames),{formatMessage:a}=u(),{trackUsage:i}=$(),{toggleNotification:t}=G(),{notifyStatus:y}=J(),E=f(o=>o.admin_app.theme.currentTheme),A=K(),{_unstableFormatValidationErrors:v,_unstableFormatAPIError:L}=Y(),d=W("ProfilePage",o=>o.user);S.useEffect(()=>{d?y(a({id:"Settings.profile.form.notify.data.loaded",defaultMessage:"Your profile data has been loaded"})):t({type:"danger",message:a({id:"notification.error",defaultMessage:"An error occured"})})},[a,y,t,d]);const[R,{isLoading:_}]=X(),{isLoading:k,data:z,error:M}=Z(void 0,{skip:!(window.strapi.isEE&&window.strapi.features.isEnabled("sso"))});S.useEffect(()=>{M&&t({type:"danger",message:a({id:"Settings.permissions.users.sso.provider.error"})})},[M,a,t]);const C=async(o,{setErrors:p})=>{const{confirmPassword:pe,currentTheme:j,...H}=o;let c=H;if(c.password===""){const{password:ge,currentPassword:fe,...V}=c;c=V}const n=await R(c);"data"in n&&(A(ie(j)),i("didChangeMode",{newMode:j}),t({type:"success",message:a({id:"notification.success.saved",defaultMessage:"Saved"})})),"error"in n&&(T(n.error)&&n.error.name==="ValidationError"?p(v(n.error)):T(n.error)?t({type:"danger",message:L(n.error)}):t({type:"danger",message:a({id:"notification.error",defaultMessage:"An error occured"})}))};if(k)return e.jsx(g.Loading,{});const F=z?.isSSOLocked??!1,{email:D,firstname:N,lastname:O,username:U,preferedLanguage:q}=d??{},B={email:D??"",firstname:N??"",lastname:O??"",username:U??"",preferedLanguage:q,currentTheme:E,confirmPassword:"",password:""};return e.jsx(e.Fragment,{children:e.jsxs(g.Main,{"aria-busy":_,children:[e.jsx(g.Title,{children:a({id:"Settings.profile.form.section.head.title",defaultMessage:"User profile"})}),e.jsx(ee,{method:"PUT",onSubmit:C,initialValues:B,validationSchema:de,children:({isSubmitting:o,modified:p})=>e.jsxs(e.Fragment,{children:[e.jsx(P.Header,{title:ne(d),primaryAction:e.jsx(ae,{startIcon:e.jsx(re,{}),loading:o,type:"submit",disabled:!p,children:a({id:"global.save",defaultMessage:"Save"})})}),e.jsx(h,{paddingBottom:6,children:e.jsx(P.Content,{children:e.jsxs(b,{direction:"column",alignItems:"stretch",gap:6,children:[e.jsx(ue,{}),!F&&e.jsx(ce,{}),e.jsx(me,{localeNames:s})]})})})]})}),r&&!1]})})},ce=()=>{const{formatMessage:r}=u();return e.jsxs(w,{children:[e.jsx(m,{variant:"delta",tag:"h2",children:r({id:"global.change-password",defaultMessage:"Change password"})}),[[{label:r({id:"Auth.form.currentPassword.label",defaultMessage:"Current Password"}),name:"currentPassword",size:6,type:"password"}],[{autoComplete:"new-password",label:r({id:"global.password",defaultMessage:"Password"}),name:"password",size:6,type:"password"},{autoComplete:"new-password",label:r({id:"Auth.form.confirmPassword.label",defaultMessage:"Confirm Password"}),name:"confirmPassword",size:6,type:"password"}]].map((s,a)=>e.jsx(l.Root,{gap:5,children:s.map(({size:i,...t})=>e.jsx(l.Item,{xs:12,m:6,col:i,direction:"column",alignItems:"stretch",children:e.jsx(x,{...t})},t.name))},a))]})},me=({localeNames:r})=>{const{formatMessage:s}=u(),a=f(i=>i.admin_app.theme.availableThemes);return e.jsxs(w,{children:[e.jsxs(b,{direction:"column",alignItems:"stretch",gap:1,children:[e.jsx(m,{variant:"delta",tag:"h2",children:s({id:"Settings.profile.form.section.experience.title",defaultMessage:"Experience"})}),e.jsx(m,{children:s({id:"Settings.profile.form.section.experience.interfaceLanguageHelp",defaultMessage:"Preference changes will apply only to you. More information is available {here}."},{here:e.jsx(h,{tag:"a",color:"primary600",target:"_blank",rel:"noopener noreferrer",href:"https://docs.strapi.io/developer-docs/latest/development/admin-customization.html#locales",children:s({id:"Settings.profile.form.section.experience.here",defaultMessage:"here"})})})})]}),e.jsx(l.Root,{gap:5,children:[{hint:s({id:"Settings.profile.form.section.experience.interfaceLanguage.hint",defaultMessage:"This will only display your own interface in the chosen language."}),label:s({id:"Settings.profile.form.section.experience.interfaceLanguage",defaultMessage:"Interface language"}),name:"preferedLanguage",options:Object.entries(r).map(([i,t])=>({label:t,value:i})),placeholder:s({id:"global.select",defaultMessage:"Select"}),size:6,type:"enumeration"},{hint:s({id:"Settings.profile.form.section.experience.mode.hint",defaultMessage:"Displays your interface in the chosen mode."}),label:s({id:"Settings.profile.form.section.experience.mode.label",defaultMessage:"Interface mode"}),name:"currentTheme",options:[{label:s({id:"Settings.profile.form.section.experience.mode.option-system-label",defaultMessage:"Use system settings"}),value:"system"},...a.map(i=>({label:s({id:"Settings.profile.form.section.experience.mode.option-label",defaultMessage:"{name} mode"},{name:s({id:i,defaultMessage:oe(i)})}),value:i}))],placeholder:s({id:"components.Select.placeholder",defaultMessage:"Select"}),size:6,type:"enumeration"}].map(({size:i,...t})=>e.jsx(l.Item,{xs:12,m:6,col:i,direction:"column",alignItems:"stretch",children:e.jsx(x,{...t})},t.name))})]})},ue=()=>{const{formatMessage:r}=u();return e.jsxs(w,{children:[e.jsx(m,{variant:"delta",tag:"h2",children:r({id:"global.profile",defaultMessage:"Profile"})}),e.jsx(l.Root,{gap:5,children:[{label:r({id:"Auth.form.firstname.label",defaultMessage:"First name"}),name:"firstname",required:!0,size:6,type:"string"},{label:r({id:"Auth.form.lastname.label",defaultMessage:"Last name"}),name:"lastname",size:6,type:"string"},{label:r({id:"Auth.form.email.label",defaultMessage:"Email"}),name:"email",required:!0,size:6,type:"email"},{label:r({id:"Auth.form.username.label",defaultMessage:"Username"}),name:"username",size:6,type:"string"}].map(({size:s,...a})=>e.jsx(l.Item,{xs:12,m:6,col:s,direction:"column",alignItems:"stretch",children:e.jsx(x,{...a})},a.name))})]})};export{we as ProfilePage};
