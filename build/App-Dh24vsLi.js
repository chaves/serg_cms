const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["ConfigureTheView-s5mOFYcQ.js","strapi-CDBlFoOX.js","strapi-D6821bIJ.css"])))=>i.map(i=>d[i]);
import{d6 as v,B as ge,d0 as Ue,cY as De,d3 as Pe,gK as O,da as r,j as e,de as k,df as B,kG as Ve,kH as ze,kI as Oe,dd as F,kJ as it,kK as Fe,kL as ot,r as y,kM as lt,dh as ae,kN as dt,kO as rt,kP as ct,kQ as ut,di as P,kR as Te,dg as Ie,n as M,kS as Qe,kT as pt,gP as se,kU as H,kV as Ne,c9 as He,kW as u,kX as Ge,kY as ht,kZ as gt,k_ as Z,k$ as Q,l0 as ft,l1 as xt,l2 as Y,l3 as mt,l4 as jt,gm as yt,cX as Ct,l5 as bt,l6 as We,l7 as At,db as T,l8 as vt,l9 as Mt,la as qe,d8 as wt,d7 as kt,lb as G,lc as St,ld as Ft,le as Tt,bR as It,bS as Et,lf as Lt,lg as Rt,i1 as _t,lh as $t,li as Bt,lj as Ut,lk as he,u as ne,ll as Ee,lm as Dt,ln as Pt,lo as Le,lp as Vt,b7 as Ke,K as te,gN as zt,b9 as Xe,b1 as Ot,gO as Qt,lq as Nt,a4 as Ht,b as Gt,lr as Wt,ls as qt,lt as Kt,lu as Xt,lv as Jt,lw as Zt,P as V,af as Yt,lx as es,ly as ts,lz as ss,lA as ee,lB as as,lC as ns,lD as is,lE as os,lF as ls,lG as ds,lH as rs,lI as cs,lJ as us,dV as pe,lK as ps,lL as hs,lM as gs,lN as fs,gM as xs,$ as ms,a0 as Re,a1 as js}from"./strapi-CDBlFoOX.js";import{S as ys}from"./SearchInput-sfV6TLEV.js";const Cs=()=>{const{formatMessage:t}=v(),{toggleNotification:a}=ge(),n=Ue(),{post:s}=De(),i=Pe(({updates:h})=>s("/upload/actions/bulk-update",{updates:h}),{onSuccess(h){const{data:x}=h;x&&x.length>0&&(n.refetchQueries([O,"assets"],{active:!0}),n.refetchQueries([O,"asset-count"],{active:!0}),n.refetchQueries([O,"folders"],{active:!0})),a({type:"success",message:t({id:r("modal.edit.success-label"),defaultMessage:"Files have been successfully updated."})})}});return{...i,edit:h=>i.mutateAsync({updates:h})}},Je=M(mt)`
  opacity: 0;
  z-index: 1;

  &:focus-within {
    opacity: 1;
  }
`,bs=M(k)`
  background: ${({theme:t})=>t.colors.neutral0};
  border: 1px solid ${({theme:t})=>t.colors.neutral150};
  border-radius: ${({theme:t})=>t.borderRadius};

  &:hover {
    ${Je} {
      opacity: 1;
    }
  }
`,As=({asset:t})=>{const{formatMessage:a}=v(),n=N("AssetCardActions",o=>o.dispatch),s=N("AssetCardActions",o=>o.state),l=N("AssetCardActions",o=>o.onClose),{canUpdate:i,canCopyLink:c,canDownload:h}=Qe(),[x,g]=y.useState(!1),{removeAsset:j}=pt(()=>{}),f=async o=>{o?.preventDefault(),await j(t.id),n({type:"remove_uploaded_asset",payload:{id:t.id}}),s.uploadedAssets.length===1&&l()},m=o=>{o.stopPropagation()},A=o=>{o&&(n({type:"edit_uploaded_asset",payload:{editedAsset:o}}),g(!1))};return e.jsxs(Je,{onClick:m,position:"end",children:[e.jsxs(se.Root,{children:[e.jsx(se.Trigger,{children:e.jsx(H,{label:a({id:r("control-card.remove-selection"),defaultMessage:"Remove from selection"}),children:e.jsx(Ne,{})})}),e.jsx(He,{onConfirm:f})]}),e.jsxs(u.Root,{open:x,onOpenChange:g,children:[e.jsx(u.Trigger,{children:e.jsx(H,{label:a({id:r("control-card.edit"),defaultMessage:"Edit"}),children:e.jsx(Ge,{})})}),e.jsx(u.Content,{children:e.jsx(ht,{asset:{...t,isLocal:!1,folder:typeof t.folder=="number"?{id:t.folder}:t.folder},onClose:o=>A(o),canUpdate:i,canCopyLink:c,canDownload:h,omitFields:["caption","alternativeText"],omitActions:["replace"]})})]})]})},vs=M.span`
  text-transform: uppercase;
`,Ms=M(k)`
  position: relative;
  height: 100%;
  overflow: hidden;

  canvas,
  video {
    display: block;
    pointer-events: none;
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: ${({theme:t})=>t.borderRadius};
  }
`,ws=M(jt)`
  position: absolute;
  bottom: 0.5rem;
  right: 0.5rem;
`,ks=M(k)`
  height: 100%;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;

  canvas,
  audio {
    display: block;
    max-width: 100%;
    max-height: 100%;
  }
`,Ss=({assetType:t,thumbnailUrl:a,assetUrl:n,asset:s})=>{const[l,i]=y.useState(),c=l?gt(l):void 0;switch(t){case Q.Image:return e.jsx(Z,{src:a,size:"S",alt:s.alternativeText||s.name});case Q.Video:return e.jsx(Z,{size:"S",children:e.jsxs(Ms,{children:[e.jsx(xt,{url:n,mime:s.mime||"video/mp4",onLoadDuration:i,alt:s.alternativeText||s.name}),c&&e.jsx(ws,{children:c})]})});case Q.Audio:return e.jsx(Z,{size:"S",children:e.jsx(ks,{children:e.jsx(ft,{url:n,alt:s.alternativeText||s.name})})});default:return e.jsx(Z,{src:a,size:"S",alt:s.alternativeText||s.name})}},Fs=M(ze)`
  display: flex;
  padding: ${({theme:t})=>t.spaces[2]} ${({theme:t})=>t.spaces[1]};
`,Ts=M(Ve)`
  width: 100%;
  height: 100%;
  border: none;
  box-shadow: none;
  border-radius: 0;
  padding: 0;
`,Is=t=>{switch(t){case Q.Image:return{id:r("settings.section.image.label"),defaultMessage:"IMAGE"};case Q.Video:return{id:r("settings.section.video.label"),defaultMessage:"VIDEO"};case Q.Audio:return{id:r("settings.section.audio.label"),defaultMessage:"AUDIO"};case Y.Pdf:return{id:r("settings.section.pdf.label"),defaultMessage:"PDF"};case Y.Csv:return{id:r("settings.section.csv.label"),defaultMessage:"CSV"};case Y.Xls:return{id:r("settings.section.xls.label"),defaultMessage:"XLS"};case Y.Zip:return{id:r("settings.section.zip.label"),defaultMessage:"ZIP"};default:return{id:r("settings.section.doc.label"),defaultMessage:"DOC"}}},Es=({asset:t,onCaptionChange:a,onAltTextChange:n,wasAltTextChanged:s,wasCaptionChanged:l})=>{const{formatMessage:i}=v(),c=it(t.mime||""),h=Fe(t?.formats?.thumbnail?.url||t.url)||"",x=Fe(t.url)||"",g=t.height&&t.width?` - ${t.width}x${t.height}`:"",j=t.size?ot(t.size):"",f=`${g}${g&&j?" - ":""}${j}`,[m,A]=y.useState(t.caption||"");y.useEffect(()=>{a(m)},[m,a]);const[o,L]=y.useState(t.alternativeText||"");return y.useEffect(()=>{n(o)},[o,n]),e.jsx(bs,{children:e.jsxs(B.Root,{children:[e.jsx(B.Item,{m:5,xs:12,alignItems:"stretch",children:e.jsxs(Ts,{width:"100%",height:"100%",shadow:"none",borderRadius:0,padding:0,children:[e.jsxs(lt,{style:{borderStyle:"none"},children:[e.jsx(As,{asset:t}),e.jsx(Ss,{assetType:c,thumbnailUrl:h,assetUrl:x,asset:t})]}),e.jsx(Fs,{children:e.jsxs(Oe,{width:"100%",children:[e.jsxs(F,{justifyContent:"space-between",alignItems:"start",children:[e.jsx(ae,{tag:"h2",children:e.jsx(dt,{tag:"span",children:t.name})}),e.jsx(rt,{children:i(Is(c))})]}),e.jsx(F,{children:e.jsxs(ct,{children:[e.jsx(vs,{children:ut(t.ext)}),f]})})]})})]})}),e.jsx(B.Item,{m:7,xs:12,flex:1,children:e.jsxs(F,{direction:"column",height:"100%",alignItems:"stretch",flex:1,padding:4,gap:2,children:[e.jsxs(P.Root,{name:"caption",children:[e.jsx(F,{alignItems:"center",gap:2,children:e.jsx(P.Label,{children:i({id:r("form.input.label.file-caption"),defaultMessage:"Caption"})})}),e.jsx(Te,{value:m,onChange:S=>A(S.target.value),placeholder:i({id:r("form.input.placeholder.file-caption"),defaultMessage:"Enter caption"}),endAction:!l&&t.caption&&e.jsx(Ie,{width:"16px",height:"16px",fill:"#AC73E6"}),type:"text"})]}),e.jsxs(P.Root,{name:"alternativeText",hint:i({id:r("form.input.description.file-alt"),defaultMessage:"This text will be displayed if the asset can't be shown."}),children:[e.jsx(F,{alignItems:"center",gap:2,children:e.jsx(P.Label,{children:i({id:r("form.input.label.file-alt"),defaultMessage:"Alternative text"})})}),e.jsx(Te,{value:o,onChange:S=>L(S.target.value),placeholder:i({id:r("form.input.placeholder.file-alt"),defaultMessage:"Enter alternative text"}),endAction:!s&&t.alternativeText&&e.jsx(Ie,{width:"16px",height:"16px",fill:"#AC73E6"}),type:"text"}),e.jsx(P.Hint,{})]})]})})]})})},$=M(k)`
  background: linear-gradient(
    90deg,
    ${({theme:t})=>t.colors.neutral100} 25%,
    ${({theme:t})=>t.colors.neutral150} 50%,
    ${({theme:t})=>t.colors.neutral100} 75%
  );
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
  border-radius: ${({theme:t})=>t.borderRadius};
  width: ${({width:t})=>t||"100%"};
  height: ${({height:t})=>t||"1rem"};

  @keyframes loading {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }
`,Ls=({count:t=1})=>Array.from({length:t},(n,s)=>s).map(n=>e.jsx(k,{background:"neutral0",borderColor:"neutral150",borderStyle:"solid",borderWidth:"1px",borderRadius:"4px",marginBottom:4,children:e.jsxs(B.Root,{children:[e.jsx(B.Item,{col:5,alignItems:"stretch",children:e.jsxs(Ve,{height:"100%",width:"100%",borderStyle:"none",shadow:"none",borderRadius:0,padding:2,children:[e.jsx(k,{height:"150px",padding:2,children:e.jsx($,{height:"100%"})}),e.jsx(ze,{style:{display:"flex",padding:"8px 4px"},children:e.jsxs(Oe,{width:"100%",children:[e.jsxs(F,{justifyContent:"space-between",alignItems:"start",marginBottom:1,children:[e.jsx($,{width:"60%",height:"18px"}),e.jsx($,{width:"40px",height:"16px"})]}),e.jsx($,{width:"80%",height:"14px"})]})})]})}),e.jsx(B.Item,{m:7,xs:12,flex:1,children:e.jsxs(F,{direction:"column",height:"100%",alignItems:"stretch",flex:1,padding:4,gap:2,children:[e.jsxs(k,{children:[e.jsx($,{width:"60px",height:"16px",marginBottom:1}),e.jsx($,{height:"32px"})]}),e.jsxs(k,{children:[e.jsx($,{width:"100px",height:"16px",marginBottom:1}),e.jsx($,{height:"32px"}),e.jsx(k,{marginTop:1,children:e.jsx($,{width:"70%",height:"12px"})})]})]})})]})},n)),_e=M(u.Body)`
  padding: 0;
  display: flex;
  justify-content: center;

  [data-radix-scroll-area-viewport] {
    padding-top: ${({theme:t})=>t.spaces[6]};
    padding-bottom: ${({theme:t})=>t.spaces[6]};
    padding-left: ${({theme:t})=>t.spaces[7]};
    padding-right: ${({theme:t})=>t.spaces[7]};
  }
`,Rs=M(vt)`
  & > button {
    display: none;
  }
`,_s=({onClose:t})=>{const{formatMessage:a}=v(),{toggleNotification:n}=ge(),s=N("ModalContent",p=>p.state),l=N("ModalContent",p=>p.dispatch),i=N("ModalContent",p=>p.folderId),{upload:c}=bt(),{edit:h,isLoading:x}=Cs(),[g,j]=y.useState(!1),[f,m]=y.useState(null),{trackUsage:A}=We(),o=(p,b)=>{l({type:"set_uploaded_asset_caption",payload:{id:p,caption:b}})},L=(p,b)=>{l({type:"set_uploaded_asset_alt_text",payload:{id:p,altText:b}})},S=()=>{l({type:"set_uploaded_assets",payload:[]})},W=async()=>{if(s.hasUnsavedChanges){const p=s.uploadedAssets.filter(b=>(b.wasCaptionChanged||b.wasAltTextChanged)&&b.file.id);if(p.length>0){p.some(C=>C.wasCaptionChanged)&&A("didEditAICaption"),p.some(C=>C.wasAltTextChanged)&&A("didEditAIAlternativeText");const b=p.map(C=>({id:C.file.id,fileInfo:{name:C.file.name,alternativeText:C.file.alternativeText??null,caption:C.file.caption??null,folder:typeof C.file.folder=="object"&&C.file.folder!==null?C.file.folder.id:C.file.folder}}));try{await h(b),l({type:"clear_unsaved_changes"})}catch(C){n({type:"danger",message:(C instanceof Error?C.message:null)||a({id:"notification.error",defaultMessage:"An error occurred"})});return}}}S(),t()},q=()=>{S(),t()},R=async p=>{l({type:"set_assets_to_upload_length",payload:p.length}),m(null),j(!0);try{const b=p.map(U=>({...U,id:U.id?Number(U.id):void 0})),D=(await c(b,i)).map(U=>({...U,folder:i||U.folder}));l({type:"set_uploaded_assets",payload:D})}catch(b){console.error("Upload failed:",b),m(b instanceof Error?b:new Error("Upload failed"))}finally{j(!1)}};if(s.assetsToUploadLength===0)return e.jsx(u.Content,{children:e.jsx(At,{onClose:t,onAddAsset:R})});if(g||s.assetsToUploadLength>0&&s.uploadedAssets.length===0&&!f)return e.jsxs(u.Content,{children:[e.jsx(u.Header,{children:e.jsx(u.Title,{children:a({id:r("ai.modal.uploading.title"),defaultMessage:"Uploading and processing with AI..."})})}),e.jsx(_e,{children:e.jsx(Ls,{count:s.assetsToUploadLength})})]});const w=a({id:r("ai.modal.title"),defaultMessage:"{count, plural, one {# asset uploaded} other {# assets uploaded}}, review AI generated metadata"},{count:s.uploadedAssets.length});return f?e.jsxs(u.Content,{children:[e.jsx(u.Header,{children:e.jsx(u.Title,{children:w})}),e.jsx(u.Body,{children:e.jsx(Rs,{closeLabel:"",variant:"danger",children:a({id:r("ai.modal.error"),defaultMessage:"Could not generate AI metadata for the uploaded files."})})}),e.jsxs(u.Footer,{children:[e.jsx(T,{onClick:q,variant:"tertiary",children:a({id:"cancel",defaultMessage:"Cancel"})}),e.jsx(T,{onClick:W,loading:x,children:a({id:"global.finish",defaultMessage:"Finish"})})]})]}):e.jsxs(u.Content,{children:[e.jsx(u.Header,{children:e.jsx(u.Title,{children:w})}),e.jsx(_e,{children:e.jsx(F,{gap:6,direction:"column",alignItems:"stretch",children:s.uploadedAssets.map(({file:p,wasCaptionChanged:b,wasAltTextChanged:C})=>e.jsx(Es,{asset:p,onCaptionChange:D=>p.id&&o(p.id,D),onAltTextChange:D=>p.id&&L(p.id,D),wasCaptionChanged:b,wasAltTextChanged:C},p.id))})}),e.jsxs(u.Footer,{children:[e.jsx(T,{onClick:q,variant:"tertiary",children:a({id:"cancel",defaultMessage:"Cancel"})}),e.jsx(T,{onClick:W,loading:x,children:a({id:"global.finish",defaultMessage:"Finish"})})]})]})},[$s,N]=yt("AIUploadModalContext"),Bs=(t,a)=>Ct(t,n=>{if(a.type==="set_uploaded_assets"&&(n.uploadedAssets=a.payload.map(s=>({file:s,wasCaptionChanged:!1,wasAltTextChanged:!1})),n.hasUnsavedChanges=!1),a.type==="set_assets_to_upload_length"&&(n.assetsToUploadLength=a.payload),a.type==="set_uploaded_asset_caption"){const s=n.uploadedAssets.find(l=>l.file.id===a.payload.id);s&&s.file.caption!==a.payload.caption&&(s.file.caption=a.payload.caption,s.wasCaptionChanged=!0,n.hasUnsavedChanges=!0)}if(a.type==="set_uploaded_asset_alt_text"){const s=n.uploadedAssets.find(l=>l.file.id===a.payload.id);s&&s.file.alternativeText!==a.payload.altText&&(s.file.alternativeText=a.payload.altText,s.wasAltTextChanged=!0,n.hasUnsavedChanges=!0)}if(a.type==="remove_uploaded_asset"&&(n.uploadedAssets=n.uploadedAssets.filter(s=>s.file.id!==a.payload.id)),a.type==="edit_uploaded_asset"){const s=n.uploadedAssets.findIndex(l=>l.file.id===a.payload.editedAsset.id);s!==-1&&(n.uploadedAssets[s]={file:a.payload.editedAsset,wasCaptionChanged:n.uploadedAssets[s].wasCaptionChanged,wasAltTextChanged:n.uploadedAssets[s].wasAltTextChanged})}a.type==="clear_unsaved_changes"&&(n.hasUnsavedChanges=!1,n.uploadedAssets.forEach(s=>{s.wasCaptionChanged=!1,s.wasAltTextChanged=!1}))}),Us=({open:t,onClose:a,folderId:n=null})=>{const[s,l]=y.useReducer(Bs,{uploadedAssets:[],assetsToUploadLength:0,hasUnsavedChanges:!1}),i=y.useCallback(()=>{l({type:"set_uploaded_assets",payload:[]}),a()},[a]);return e.jsx($s,{state:s,dispatch:l,folderId:n,onClose:i,children:e.jsx(u.Root,{open:t,onOpenChange:i,children:e.jsx(_s,{onClose:i})})})},Ds=t=>{const{id:a}=Mt();return e.jsx(k,{position:"relative",zIndex:2,children:e.jsx(qe,{"aria-labelledby":`${a}-title`,...t})})},Ps=()=>{const t=wt(),{status:a,data:n}=kt(t);return t?{status:a,isEnabled:n?.aiMetadata}:{status:"success",isEnabled:!1}},Vs=(t,{pathname:a,query:n})=>{const s=[{id:null,label:{id:r("plugin.name"),defaultMessage:"Media Library"},href:t?G(a,n||{}):void 0}];return t?.parent&&typeof t?.parent!="number"&&t?.parent?.parent&&s.push([]),t?.parent&&typeof t.parent!="number"&&s.push({id:t.parent.id,label:t.parent.name,href:G(a,n||{},{folder:t.parent.id?.toString(),folderPath:t.parent.path})}),t&&s.push({id:t.id,label:t.name}),s},zs=({selected:t,onSuccess:a})=>{const{formatMessage:n}=v(),{remove:s}=St(),l=async()=>{await s(t),a()};return e.jsxs(se.Root,{children:[e.jsx(se.Trigger,{children:e.jsx(T,{variant:"danger-light",size:"S",startIcon:e.jsx(Ne,{}),children:n({id:"global.delete",defaultMessage:"Delete"})})}),e.jsx(He,{onConfirm:l})]})},Os=()=>{const{formatMessage:t}=v(),{toggleNotification:a}=ge(),n=Ue(),{post:s}=De(),i=Pe(({destinationFolderId:h,filesAndFolders:x})=>{const g=x.reduce((j,f)=>{const{id:m,type:A}=f,o=A==="asset"?"fileIds":"folderIds";return j[o]||(j[o]=[]),j[o].push(m),j},{});return s("/upload/actions/bulk-move",{...g,destinationFolderId:h})},{onSuccess(h){const{data:{data:x}}=h;x?.files?.length>0&&(n.refetchQueries([O,"assets"],{active:!0}),n.refetchQueries([O,"asset-count"],{active:!0})),n.refetchQueries([O,"folders"],{active:!0}),a({type:"success",message:t({id:r("modal.move.success-label"),defaultMessage:"Elements have been moved successfully."})})}});return{...i,move:(h,x)=>i.mutateAsync({destinationFolderId:h,filesAndFolders:x})}},Qs=({onClose:t,selected:a=[],currentFolder:n})=>{const{formatMessage:s}=v(),{data:l,isLoading:i}=Ft(),{move:c}=Os();if(!l)return null;const h=async(g,{setErrors:j})=>{try{if(typeof g.destination!="string"){const f=g.destination.value;await c(f,a),t()}}catch(f){const m=Rt(f);if(m&&"errors"in m){const A=m.errors?.reduce((o,L)=>(o[L.values?.path?.length||"destination"]=L.defaultMessage,o),{});_t(A)||j(A)}}};if(i)return e.jsx(u.Content,{children:e.jsx(u.Body,{children:e.jsx(F,{justifyContent:"center",paddingTop:4,paddingBottom:4,children:e.jsx(Tt,{children:s({id:r("content.isLoading"),defaultMessage:"Content is loading."})})})})});const x={destination:{value:n?.id||"",label:n?.name||l[0].label}};return e.jsx(u.Content,{children:e.jsx(It,{validateOnChange:!1,onSubmit:h,initialValues:x,children:({values:g,errors:j,setFieldValue:f})=>e.jsxs(Et,{noValidate:!0,children:[e.jsx(u.Header,{children:e.jsx(u.Title,{children:s({id:r("modal.folder.move.title"),defaultMessage:"Move elements to"})})}),e.jsx(u.Body,{children:e.jsx(B.Root,{gap:4,children:e.jsx(B.Item,{xs:12,direction:"column",alignItems:"stretch",children:e.jsxs(P.Root,{id:"folder-destination",children:[e.jsx(P.Label,{children:s({id:r("form.input.label.folder-location"),defaultMessage:"Location"})}),e.jsx(Lt,{options:l,onChange:m=>{f("destination",m)},defaultValue:typeof g.destination!="string"?g.destination:void 0,name:"destination",menuPortalTarget:document.querySelector("body"),inputId:"folder-destination",error:j?.destination,ariaErrorMessage:"destination-error"}),j.destination&&e.jsx(ae,{variant:"pi",tag:"p",textColor:"danger600",children:j.destination})]})})})}),e.jsxs(u.Footer,{children:[e.jsx(u.Close,{children:e.jsx(T,{variant:"tertiary",name:"cancel",children:s({id:"global.cancel",defaultMessage:"Cancel"})})}),e.jsx(T,{type:"submit",loading:i,children:s({id:"global.move",defaultMessage:"Move"})})]})]})})})},Ns=({selected:t=[],onSuccess:a,currentFolder:n})=>{const{formatMessage:s}=v(),[l,i]=y.useState(!1),c=()=>{i(!1),a()};return e.jsxs(u.Root,{open:l,onOpenChange:i,children:[e.jsx(u.Trigger,{children:e.jsx(T,{variant:"secondary",size:"S",startIcon:e.jsx($t,{}),children:s({id:"global.move",defaultMessage:"Move"})})}),e.jsx(Qs,{currentFolder:n,onClose:c,selected:t})]})},Hs=({selected:t=[],onSuccess:a,currentFolder:n})=>{const{formatMessage:s}=v(),l=t?.reduce(function(i,c){return c?.type==="folder"&&"files"in c&&c?.files&&"count"in c.files?i+c?.files?.count:i+1},0);return e.jsxs(F,{gap:2,paddingBottom:5,children:[e.jsx(ae,{variant:"epsilon",textColor:"neutral600",children:s({id:r("list.assets.selected"),defaultMessage:"{numberFolders, plural, one {1 folder} other {# folders}} - {numberAssets, plural, one {1 asset} other {# assets}} selected"},{numberFolders:t?.filter(({type:i})=>i==="folder").length,numberAssets:l})}),e.jsx(zs,{selected:t,onSuccess:a}),e.jsx(Ns,{currentFolder:n,selected:t,onSuccess:a})]})},Gs=({isFiltering:t,canCreate:a,canRead:n})=>t?{id:"list.assets-empty.title-withSearch",defaultMessage:"There are no elements with the applied filters"}:n?a?{id:"list.assets.empty-upload",defaultMessage:"Upload your first assets..."}:{id:"list.assets.empty",defaultMessage:"Media Library is empty"}:{id:"header.actions.no-permissions",defaultMessage:"No permissions to view"},Ws=({canCreate:t,isFiltering:a,canRead:n,onActionClick:s})=>{const{formatMessage:l}=v(),i=Gs({isFiltering:a,canCreate:t,canRead:n});return e.jsx(Bt,{icon:n?void 0:Ut,action:t&&!a&&e.jsx(T,{variant:"secondary",startIcon:e.jsx(he,{}),onClick:s,children:l({id:r("header.actions.add-assets"),defaultMessage:"Add new assets"})}),content:l({...i,id:r(i.id)})})},qs=()=>{const[t,a]=y.useState(!1),{formatMessage:n}=v(),{trackUsage:s}=We(),[{query:l},i]=ne(),c=l?.filters?.$and||[],h=g=>{i({filters:{$and:g},page:1})},x=g=>{s("didFilterMediaLibraryElements",{location:"content-manager",filter:Object.keys(g[g.length-1])[0]}),i({filters:{$and:g},page:1})};return e.jsxs(Ee.Root,{open:t,onOpenChange:a,children:[e.jsx(Ee.Trigger,{children:e.jsx(T,{variant:"tertiary",startIcon:e.jsx(Dt,{}),size:"S",children:n({id:"app.utils.filters",defaultMessage:"Filters"})})}),e.jsx(Pt,{displayedFilters:Le,filters:c,onSubmit:x,onToggle:a}),e.jsx(Vt,{appliedFilters:c,filtersSchema:Le,onRemoveFilter:h})]})},Ks=({breadcrumbs:t=null,canCreate:a,folder:n=null,onToggleEditFolderDialog:s,onToggleUploadAssetDialog:l})=>{const{formatMessage:i}=v(),{pathname:c}=Ke(),[{query:h}]=ne(),x={...h,folder:n?.parent&&typeof n.parent!="number"&&n.parent.id?n.parent.id:void 0,folderPath:n?.parent&&typeof n.parent!="number"&&n.parent.path?n.parent.path:void 0};return e.jsx(te.Header,{title:i({id:r("plugin.name"),defaultMessage:"Media Library"}),subtitle:t&&typeof t!="boolean"&&n&&e.jsx(Nt,{label:i({id:r("header.breadcrumbs.nav.label"),defaultMessage:"Folders navigation"}),breadcrumbs:t,currentFolderId:n?.id}),navigationAction:n&&e.jsx(zt,{tag:Ot,startIcon:e.jsx(Qt,{}),to:`${c}?${Xe.stringify(x,{encode:!1})}`,children:i({id:r("header.actions.folder-level-up"),defaultMessage:"Back"})}),primaryAction:a&&e.jsxs(F,{gap:2,children:[e.jsx(T,{startIcon:e.jsx(he,{}),variant:"secondary",onClick:s,children:i({id:r("header.actions.add-folder"),defaultMessage:"Add new folder"})}),e.jsx(T,{startIcon:e.jsx(he,{}),onClick:l,children:i({id:r("header.actions.add-assets"),defaultMessage:"Add new assets"})})]})})},Xs=M(k)`
  height: 3.2rem;
  display: flex;
  align-items: center;
`,$e=M(ae)`
  max-width: 100%;
`,Be=M(k)`
  svg {
    path {
      fill: ${({theme:t})=>t.colors.neutral500};
    }
  }
`,Js=()=>{const t=Ht(),{canRead:a,canCreate:n,canUpdate:s,canCopyLink:l,canDownload:i,canConfigureView:c,isLoading:h}=Qe(),{isEnabled:x,status:g}=Ps(),j=y.useRef(),{formatMessage:f}=v(),{pathname:m}=Ke(),{trackUsage:A}=Gt(),[{query:o},L]=ne(),S=!!(o._q||o.filters),[W,q]=Wt(fs.view,ee.GRID),R=W===ee.GRID,{data:w,isLoading:p,error:b}=qt({skipWhen:!a,query:o}),{data:C,isLoading:D,error:U}=Kt({enabled:a&&w?.pagination?.page===1&&!Xt(o),query:o}),{data:ie,isLoading:fe,error:Ze}=Jt(o?.folder,{enabled:a&&!!o?.folder});Ze?.name==="NotFoundError"&&t(m);const K=C?.map(d=>({...d,type:"folder",folderURL:G(m,o,{folder:d.id.toString(),folderPath:d.path}),isSelectable:s}))??[],I=K?.length||0,X=w?.results?.map(d=>({...d,type:"asset",isSelectable:s}))||[],E=X?.length??0,Ye=w?.pagination?.total,et=fe||D||h||p||g==="loading",[oe,tt]=y.useState(!1),[xe,me]=y.useState(!1),[le,de]=y.useState(void 0),[re,je]=y.useState(void 0),[_,{selectOne:ce,selectAll:ye,setSelections:Ce}]=Zt(["type","id"],[]);y.useEffect(()=>{Ce([])},[o.folder,Ce]);const be=_?.length>0&&_?.length!==E+I,J=()=>tt(d=>!d),Ae=({created:d=!1}={})=>{d&&o?.page!=="1"&&L({...o,page:1}),me(z=>!z)},ve=(d,z)=>{d&&A("didSelectAllMediaLibraryElements"),ye(z)},Me=d=>{A("didSortMediaLibraryElements",{location:"upload",sort:d}),L({sort:d})},we=d=>{je(d),me(!0)},st=d=>{je(null),Ae(d),j.current&&j.current.focus()},ke=d=>{d===E&&w?.pagination?.page===w?.pagination?.pageCount&&w?.pagination?.page&&w.pagination.page>1&&L({...o,page:w.pagination.page-1})},at=()=>{ye(),ke(_.length)};return et?e.jsx(V.Loading,{}):b||U||g==="error"?e.jsx(V.Error,{}):e.jsxs(te.Root,{children:[e.jsxs(V.Main,{children:[e.jsx(Ks,{breadcrumbs:fe?null:Vs(ie,{pathname:m,query:o}),canCreate:n,onToggleEditFolderDialog:Ae,onToggleUploadAssetDialog:J,folder:ie}),e.jsx(te.Action,{startActions:e.jsxs(e.Fragment,{children:[s&&R&&(E>0||I>0)&&e.jsx(Xs,{paddingLeft:2,paddingRight:2,background:"neutral0",hasRadius:!0,borderColor:"neutral200",children:e.jsx(qe,{"aria-label":f({id:r("bulk.select.label"),defaultMessage:"Select all folders & assets"}),checked:be?"indeterminate":(E>0||I>0)&&_.length===E+I,onCheckedChange:d=>ve(d,[...X,...K])})}),a&&R&&e.jsx(as,{value:o?.sort,onChangeSort:Me}),a&&e.jsx(qs,{})]}),endActions:e.jsxs(e.Fragment,{children:[c?e.jsx(Be,{paddingTop:1,paddingBottom:1,children:e.jsx(H,{tag:Yt,to:{pathname:`${m}/configuration`,search:Xe.stringify(o,{encode:!1})},label:f({id:"app.links.configure-view",defaultMessage:"Configure the view"}),children:e.jsx(es,{})})}):null,e.jsx(Be,{paddingTop:1,paddingBottom:1,children:e.jsx(H,{label:f(R?{id:r("view-switch.list"),defaultMessage:"List View"}:{id:r("view-switch.grid"),defaultMessage:"Grid View"}),onClick:()=>q(R?ee.LIST:ee.GRID),children:R?e.jsx(ts,{}):e.jsx(ss,{})})}),e.jsx(ys,{label:f({id:r("search.label"),defaultMessage:"Search for an asset"}),trackedEvent:"didSearchMediaLibraryElements",trackedEventDetails:{location:"upload"}})]})}),e.jsxs(te.Content,{children:[_.length>0&&e.jsx(Hs,{currentFolder:ie,selected:_,onSuccess:at}),I===0&&E===0&&e.jsx(Ws,{canCreate:n,canRead:a,isFiltering:S,onActionClick:J}),a&&!R&&(E>0||I>0)&&e.jsx(ns,{assetCount:E,folderCount:I,indeterminate:be,onChangeSort:Me,onChangeFolder:(d,z)=>t(G(m,o,{folder:d.toString(),folderPath:z})),onEditAsset:de,onEditFolder:we,onSelectOne:ce,onSelectAll:ve,rows:[...K,...X],selected:_,shouldDisableBulkSelect:!s,sortQuery:o?.sort??""}),a&&R&&e.jsxs(e.Fragment,{children:[I>0&&e.jsx(is,{title:(S&&E>0||!S)&&f({id:r("list.folders.title"),defaultMessage:"Folders ({count})"},{count:I})||"",children:K.map(d=>{const nt=!!_.filter(({type:ue})=>ue==="folder").find(ue=>ue.id===d.id),Se=G(m,o,{folder:d?.id.toString(),folderPath:d?.path});return e.jsx(B.Item,{col:3,m:4,s:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(os,{ref:re&&d.id===re.id?j:void 0,ariaLabel:d.name,id:`folder-${d.id}`,to:Se,startAction:d.isSelectable?e.jsx(Ds,{"data-testid":`folder-checkbox-${d.id}`,checked:nt,onCheckedChange:()=>ce(d)}):null,cardActions:e.jsx(H,{label:f({id:r("list.folder.edit"),defaultMessage:"Edit folder"}),onClick:()=>we(d),children:e.jsx(Ge,{})}),children:e.jsx(ls,{children:e.jsx(ds,{to:Se,children:e.jsxs(F,{tag:"h2",direction:"column",alignItems:"start",maxWidth:"100%",children:[e.jsxs($e,{fontWeight:"semiBold",textColor:"neutral800",ellipsis:!0,children:[d.name,e.jsx(rs,{children:":"})]}),e.jsx($e,{tag:"span",textColor:"neutral600",variant:"pi",ellipsis:!0,children:f({id:r("list.folder.subtitle"),defaultMessage:"{folderCount, plural, =0 {# folder} one {# folder} other {# folders}}, {filesCount, plural, =0 {# asset} one {# asset} other {# assets}}"},{folderCount:d.children?.count,filesCount:d.files?.count})})]})})})})},`folder-${d.id}`)})}),E>0&&I>0&&e.jsx(k,{paddingTop:6,paddingBottom:4,children:e.jsx(cs,{})}),E>0&&e.jsx(us,{assets:X,onEditAsset:de,onSelectAsset:ce,selectedAssets:_.filter(({type:d})=>d==="asset"),title:(!S||S&&I>0)&&w?.pagination?.page===1&&f({id:r("list.assets.title"),defaultMessage:"Assets ({count})"},{count:Ye})||""})]}),e.jsxs(pe.Root,{...w?.pagination,children:[e.jsx(pe.PageSize,{}),e.jsx(pe.Links,{})]})]})]}),oe&&(x?e.jsx(Us,{open:oe,onClose:J,folderId:o?.folder?Number(o.folder):null}):e.jsx(ps,{open:oe,onClose:J,trackedLocation:"upload",folderId:o?.folder})),xe&&e.jsx(hs,{open:xe,onClose:()=>st(),folder:re,parentFolderId:o?.folder,location:"upload"}),le&&e.jsx(gs,{onClose:d=>{d===null&&ke(1),de(void 0)},open:!!le,asset:le,canUpdate:s,canCopyLink:l,canDownload:i,trackedLocation:"upload"})]})},Zs=y.lazy(async()=>js(()=>import("./ConfigureTheView-s5mOFYcQ.js"),__vite__mapDeps([0,1,2])).then(t=>({default:t.ConfigureTheView}))),ta=()=>{const{config:{isLoading:t,isError:a,data:n}}=xs(),[{rawQuery:s},l]=ne(),{formatMessage:i}=v(),c=i({id:r("plugin.name"),defaultMessage:"Media Library"});return y.useEffect(()=>{t||a||s||l({sort:n.sort,page:1,pageSize:n.pageSize})},[t,a,n,s,l]),t?e.jsx(V.Loading,{}):e.jsxs(V.Main,{children:[e.jsx(V.Title,{children:c}),s?e.jsx(y.Suspense,{fallback:e.jsx(V.Loading,{}),children:e.jsxs(ms,{children:[e.jsx(Re,{index:!0,element:e.jsx(Js,{})}),e.jsx(Re,{path:"configuration",element:e.jsx(Zs,{config:n})})]})}):null]})};export{ta as Upload};
