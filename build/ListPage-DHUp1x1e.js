import{bk as B,j as e,P as m,r as p,a as I,A as J,B as Q,a4 as X,E as Y,bl as ee,K as S,bZ as D,b1 as E,b_ as L,x as l,bi as se,b$ as $,av as te,c0 as ae,ax as W,c1 as b,c2 as F,c3 as oe,aw as ne,ay as f,v as R,c4 as ie,I as N,c5 as re,c6 as le,c7 as de,y as ce,c8 as O,c9 as _}from"./strapi-CDBlFoOX.js";import{u as he}from"./useWebhooks-DH4qwsiS.js";const ge=()=>{const[d,i]=p.useState(!1),[r,o]=p.useState([]),c=B(s=>s.admin_app.permissions.settings?.webhooks),{formatMessage:t}=I(),{_unstableFormatAPIError:h}=J(),{toggleNotification:n}=Q(),v=X(),{isLoading:H,allowedActions:{canCreate:k,canUpdate:w,canDelete:A}}=Y(c),{notifyStatus:T}=ee(),{isLoading:U,webhooks:g,error:C,updateWebhook:z,deleteManyWebhooks:P}=he();p.useEffect(()=>{if(C){n({type:"danger",message:h(C)});return}g&&T(t({id:"Settings.webhooks.list.loading.success",defaultMessage:"Webhooks have been loaded"}))},[g,C,n,t,T,h]);const G=async s=>{try{const a=await z(s);"error"in a&&n({type:"danger",message:h(a.error)})}catch{n({type:"danger",message:t({id:"notification.error",defaultMessage:"An error occurred"})})}},K=async s=>{try{const a=await P({ids:[s]});if("error"in a){n({type:"danger",message:h(a.error)});return}o(x=>x.filter(M=>M!==s))}catch{n({type:"danger",message:t({id:"notification.error",defaultMessage:"An error occurred"})})}},V=async()=>{try{const s=await P({ids:r});if("error"in s){n({type:"danger",message:h(s.error)});return}o([])}catch{n({type:"danger",message:t({id:"notification.error",defaultMessage:"An error occurred"})})}finally{i(!1)}},Z=s=>o(s?g?.map(a=>a.id)??[]:[]),q=(s,a)=>o(s?x=>[...x,a]:x=>x.filter(M=>M!==a)),y=H||U,j=g?.length??0,u=r.length;return y?e.jsx(m.Loading,{}):e.jsxs(e.Fragment,{children:[e.jsx(m.Title,{children:t({id:"Settings.PageTitle",defaultMessage:"Settings - {name}"},{name:"Webhooks"})}),e.jsxs(m.Main,{"aria-busy":y,children:[e.jsx(S.Header,{title:t({id:"Settings.webhooks.title",defaultMessage:"Webhooks"}),subtitle:t({id:"Settings.webhooks.list.description",defaultMessage:"Get POST changes notifications"}),primaryAction:k&&!y&&e.jsx(D,{tag:E,startIcon:e.jsx(L,{}),variant:"default",to:"create",size:"S",children:t({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"})})}),u>0&&A&&e.jsx(S.Action,{startActions:e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"epsilon",textColor:"neutral600",children:t({id:"Settings.webhooks.to.delete",defaultMessage:"{webhooksToDeleteLength, plural, one {# webhook} other {# webhooks}} selected"},{webhooksToDeleteLength:u})}),e.jsx(se,{onClick:()=>i(!0),startIcon:e.jsx($,{}),size:"L",variant:"danger-light",children:t({id:"global.delete",defaultMessage:"Delete"})})]})}),e.jsx(S.Content,{children:j>0?e.jsxs(te,{colCount:5,rowCount:j+1,footer:e.jsx(le,{onClick:()=>{k&&v("create")},icon:e.jsx(L,{}),children:t({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"})}),children:[e.jsx(ae,{children:e.jsxs(W,{children:[e.jsx(b,{children:e.jsx(F,{"aria-label":t({id:"global.select-all-entries",defaultMessage:"Select all entries"}),checked:u>0&&u<j?"indeterminate":u===j,onCheckedChange:Z})}),e.jsx(b,{width:"20%",children:e.jsx(l,{variant:"sigma",textColor:"neutral600",children:t({id:"global.name",defaultMessage:"Name"})})}),e.jsx(b,{width:"60%",children:e.jsx(l,{variant:"sigma",textColor:"neutral600",children:t({id:"Settings.webhooks.form.url",defaultMessage:"URL"})})}),e.jsx(b,{width:"20%",children:e.jsx(l,{variant:"sigma",textColor:"neutral600",children:t({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"})})}),e.jsx(b,{children:e.jsx(oe,{children:t({id:"Settings.webhooks.list.th.actions",defaultMessage:"Actions"})})})]})}),e.jsx(ne,{children:g?.map(s=>e.jsxs(W,{onClick:()=>{w&&v(s.id)},style:{cursor:w?"pointer":"default"},children:[e.jsx(f,{onClick:a=>a.stopPropagation(),children:e.jsx(F,{"aria-label":`${t({id:"global.select",defaultMessage:"Select"})} ${s.name}`,checked:r?.includes(s.id),onCheckedChange:a=>q(!!a,s.id),name:"select"})}),e.jsx(f,{children:e.jsx(l,{fontWeight:"semiBold",textColor:"neutral800",children:s.name})}),e.jsx(f,{children:e.jsx(l,{textColor:"neutral800",children:s.url})}),e.jsx(f,{onClick:a=>a.stopPropagation(),children:e.jsx(R,{children:e.jsx(ie,{onLabel:t({id:"global.enabled",defaultMessage:"Enabled"}),offLabel:t({id:"global.disabled",defaultMessage:"Disabled"}),"aria-label":`${s.name} ${t({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"})}`,checked:s.isEnabled,onCheckedChange:a=>{G({...s,isEnabled:a})},visibleLabels:!0})})}),e.jsx(f,{children:e.jsxs(R,{gap:1,children:[w&&e.jsx(N,{label:t({id:"Settings.webhooks.events.update",defaultMessage:"Update"}),variant:"ghost",children:e.jsx(re,{})}),A&&e.jsx(ue,{onDelete:()=>{K(s.id)}})]})})]},s.id))})]}):e.jsx(de,{icon:e.jsx(ce,{width:"160px"}),content:t({id:"Settings.webhooks.list.empty.description",defaultMessage:"No webhooks found"}),action:k?e.jsx(D,{variant:"secondary",startIcon:e.jsx(L,{}),tag:E,to:"create",children:t({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"})}):null})})]}),e.jsx(O.Root,{open:d,onOpenChange:i,children:e.jsx(_,{onConfirm:V})})]})},ue=({onDelete:d})=>{const[i,r]=p.useState(!1),{formatMessage:o}=I();return e.jsxs(e.Fragment,{children:[e.jsx(N,{onClick:c=>{c.stopPropagation(),r(!0)},label:o({id:"Settings.webhooks.events.delete",defaultMessage:"Delete webhook"}),variant:"ghost",children:e.jsx($,{})}),e.jsx(O.Root,{open:i,onOpenChange:r,children:e.jsx(_,{onConfirm:c=>{c?.stopPropagation(),d()}})})]})},fe=()=>{const d=B(i=>i.admin_app.permissions.settings?.webhooks.main);return e.jsx(m.Protect,{permissions:d,children:e.jsx(ge,{})})};export{ge as ListPage,fe as ProtectedListPage};
