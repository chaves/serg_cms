import{aT as k,b as q,ah as ye,u as D,fR as be,r as M,hU as le,bY as ce,f_ as Ce,fT as de,hV as Se,gm as Z,j as e,dV as U,hW as Me,X as Le,hX as Ae,hY as Te,gs as Re,hZ as Ie,dC as R,h_ as Ee,k as L,ge as K,h$ as ee,i0 as ue,f as O,n as X,gd as ge,aU as J,fL as Fe,i1 as we,aZ as v,fU as ke,i2 as z,E as me,i3 as G,cI as ve,dE as Pe,b0 as Oe,b9 as _,b1 as Be,i4 as $e,gq as pe,f$ as De,i5 as Ne,i6 as Ue,a4 as He,B as Ve,A as _e,i7 as he,da as We,gr as qe,i8 as ze,g2 as Ge,aD as Qe,fN as Ye,P as w,cb as H,aS as Q,bU as te,K as N,i9 as se,a_ as Ze,a$ as Ke,cl as b,aa as Xe,ia as Je,dW as Y,bN as et,gi as tt,gp as st,dA as nt,af as at,b2 as it,ib as rt,ic as ot,id as lt}from"./strapi-Bqijykrh.js";import{S as ne}from"./SearchInput-7XxRjv8R.js";import{u as ct}from"./hooks-C0E2Ztyx.js";const ae=["json","component","media","richtext","dynamiczone","password","blocks"],dt=["createdAt","updatedAt"],ut=[...le,"strapi_assignee"],ie=({disabled:t,schema:n})=>{const{attributes:s,uid:a,options:c}=n,{formatMessage:d,locale:x}=k(),{trackUsage:g}=q(),i=ye("FiltersImpl",p=>p.permissions),[{query:m}]=D(),{schemas:j}=be(),A=M.useMemo(()=>i.filter(p=>p.action==="admin::users.read"&&p.subject===null).length>0,[i]),y=(m?.filters?.$and??[]).reduce((p,E)=>{const[h,f]=Object.entries(E)[0];if(typeof f.id!="object")return p;const r=f.id.$eq||f.id.$ne,S=s[h],l=S?.type==="relation"&&"target"in S&&S.target==="admin::user";return r&&(l||ut.includes(h))&&!p.includes(r)&&p.push(r),p},[]),{data:C,isLoading:u}=ce({filters:{id:{$in:y}}},{skip:y.length===0||!A}),{users:o=[]}=C??{},{metadata:I}=Ce(a,{selectFromResult:({data:p})=>({metadata:p?.contentType.metadatas??{}})}),B=de(x,{sensitivity:"base"}),P=M.useMemo(()=>{const[{properties:{fields:p=[]}={fields:[]}}]=i.filter(h=>h.action==="plugin::content-manager.explorer.read"&&h.subject===a);return["id","documentId",...p.filter(h=>{const f=s[h]??{};return f.type&&!ae.includes(f.type)}),...dt,...A?le:[]].map(h=>{const f=s[h];if(ae.includes(f.type))return null;const{mainField:r="",label:S}=I[h].list;let l={name:h,label:S??"",mainField:Se(f,r,{schemas:j,components:{}}),type:f.type};return f.type==="relation"&&"target"in f&&f.target==="admin::user"&&(l={...l,input:gt,options:o.map(F=>({label:Z(F),value:F.id.toString()})),operators:[{label:d({id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"}),value:"$eq"},{label:d({id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"}),value:"$ne"}],mainField:{name:"id",type:"integer"}}),f.type==="enumeration"&&(l={...l,options:f.enum.map(F=>({label:F,value:F}))}),l}).filter(Boolean).toSorted((h,f)=>B.compare(h.label,f.label))},[i,A,a,s,I,j,o,d,B]),T=p=>{p&&g("willFilterEntries")},$=p=>{const E=s[p.name];E&&g("didFilterEntries",{useRelation:E.type==="relation"})};return e.jsxs(U.Root,{disabled:t,options:P,onOpenChange:T,onChange:$,children:[e.jsx(U.Trigger,{}),e.jsx(U.Popover,{zIndex:499}),e.jsx(U.List,{})]})},gt=({name:t})=>{const[n,s]=M.useState(10),[a,c]=M.useState(""),{formatMessage:d}=k(),x=Me(a,300),{data:g,isLoading:i}=ce({pageSize:n,_q:x}),m=Le(t),j=o=>{o||s(10)},{users:A=[],pagination:y}=g??{},{pageCount:C=1,page:u=1}=y??{};return e.jsx(Ae,{value:m.value,"aria-label":d({id:"content-manager.components.Filters.usersSelect.label",defaultMessage:"Search and select a user to filter"}),onOpenChange:j,onChange:o=>m.onChange(t,o),loading:i,onLoadMore:()=>s(n+10),hasMoreItems:u<C,onInputChange:o=>{c(o.currentTarget.value)},children:A.map(o=>e.jsx(Te,{value:o.id.toString(),children:Z(o)},o.id))})},W=({type:t,value:n})=>{const{formatDate:s,formatTime:a,formatNumber:c}=k();let d=n;if(t==="date"&&(d=s(Re(n),{dateStyle:"full"})),t==="datetime"&&(d=s(n,{dateStyle:"full",timeStyle:"short"})),t==="time"){const[x,g,i]=n.split(":"),m=new Date;m.setHours(x),m.setMinutes(g),m.setSeconds(i),d=a(m,{timeStyle:"short"})}return["float","decimal"].includes(t)&&(d=c(n,{maximumFractionDigits:20})),["integer","biginteger"].includes(t)&&(d=c(n,{maximumFractionDigits:0})),Ie(d)},mt=({content:t,mainField:n})=>n?e.jsx(K,{label:t[n.name],children:e.jsx(L,{maxWidth:"25rem",textColor:"neutral800",ellipsis:!0,children:e.jsx(W,{type:n.type,value:t[n.name]})})}):null,pt=({content:t,mainField:n})=>{const{formatMessage:s}=k();return n?e.jsxs(R.Root,{children:[e.jsxs(R.Trigger,{onClick:a=>a.stopPropagation(),children:[e.jsx(Ee,{children:t.length}),s({id:"content-manager.containers.list.items",defaultMessage:"{number, plural, =0 {items} one {item} other {items}}"},{number:t.length})]}),e.jsx(R.Content,{children:t.map(a=>e.jsx(R.Item,{disabled:!0,children:e.jsx(L,{maxWidth:"50rem",ellipsis:!0,children:e.jsx(W,{type:n.type,value:a[n.name]})})},a.id))})]}):null},ht=t=>t&&t[0]==="."?t.substring(1):t,fe=({url:t,mime:n,alternativeText:s,name:a,ext:c,formats:d})=>{const x=ee(t);if(n.includes("image")){const m=d?.thumbnail?.url,j=ee(m)||x;return e.jsx(ue.Item,{src:j,alt:s||a,fallback:s||a,preview:!0})}const g=ht(c),i=a.length>100?`${a.substring(0,100)}...`:a;return e.jsx(K,{label:i,children:e.jsx("span",{children:e.jsx(xe,{children:g})})})},xe=({children:t})=>e.jsx(O,{tag:"span",position:"relative",borderRadius:"50%",width:"26px",height:"26px",borderColor:"neutral200",background:"neutral150",paddingLeft:"1px",justifyContent:"center",alignItems:"center",children:e.jsx(ft,{variant:"sigma",textColor:"neutral600",children:t})}),ft=X(L)`
  font-size: 0.9rem;
  line-height: 0.9rem;
`,xt=({content:t})=>e.jsx(ue.Group,{children:t.map((n,s)=>{const a=`${n.id}${s}`;if(s===3){const c=`+${t.length-3}`;return e.jsx(xe,{children:c},a)}return s>3?null:e.jsx(fe,{...n},a)})}),jt=({mainField:t,content:n})=>e.jsx(L,{maxWidth:"50rem",textColor:"neutral800",ellipsis:!0,children:ge(n,t)}),yt=({mainField:t,content:n,rowId:s,name:a})=>{const{model:c}=J(),{formatMessage:d}=k(),{notifyStatus:x}=Fe(),[g,i]=M.useState(!1),[{query:m}]=D(),j=m.plugins?.i18n?.locale,[A]=a.split("."),{data:y,isLoading:C}=we({model:c,id:s,targetField:A,params:{locale:j}},{skip:!g,refetchOnMountOrArgChange:!0}),u=Array.isArray(n)?n.length:n.count;return M.useEffect(()=>{y&&x(d({id:v("DynamicTable.relation-loaded"),defaultMessage:"Relations have been loaded"}))},[y,d,x]),e.jsxs(R.Root,{onOpenChange:o=>i(o),children:[e.jsx(R.Trigger,{onClick:o=>o.stopPropagation(),children:e.jsx(L,{style:{cursor:"pointer"},textColor:"neutral800",fontWeight:"regular",children:u>0?d({id:"content-manager.containers.list.items",defaultMessage:"{number} {number, plural, =0 {items} one {item} other {items}}"},{number:u}):"-"})}),e.jsxs(R.Content,{children:[C&&e.jsx(R.Item,{disabled:!0,children:e.jsx(ke,{small:!0,children:d({id:v("ListViewTable.relation-loading"),defaultMessage:"Relations are loading"})})}),y?.results&&e.jsxs(e.Fragment,{children:[y.results.map(o=>e.jsx(R.Item,{children:e.jsx(L,{maxWidth:"50rem",ellipsis:!0,children:ge(o,t)})},o.documentId)),y?.pagination&&y?.pagination.total>10&&e.jsx(R.Item,{"aria-disabled":!0,"aria-label":d({id:v("ListViewTable.relation-more"),defaultMessage:"This relation contains more entities than displayed"}),children:e.jsx(L,{children:"â€¦"})})]})]})]})},bt=({content:t,mainField:n,attribute:s,rowId:a,name:c})=>{if(!Ct(t,n,s))return e.jsx(L,{textColor:"neutral800",paddingLeft:s.type==="relation"?"1.6rem":0,paddingRight:s.type==="relation"?"1.6rem":0,children:"-"});switch(s.type){case"media":return s.multiple?e.jsx(xt,{content:t}):e.jsx(fe,{...t});case"relation":return je(s.relation)?e.jsx(jt,{mainField:n,content:t}):e.jsx(yt,{rowId:a,mainField:n,content:t,name:c});case"component":return s.repeatable?e.jsx(pt,{mainField:n,content:t}):e.jsx(mt,{mainField:n,content:t});case"string":return e.jsx(K,{label:t,children:e.jsx(L,{maxWidth:"30rem",ellipsis:!0,textColor:"neutral800",children:e.jsx(W,{type:s.type,value:t})})});default:return e.jsx(L,{maxWidth:"30rem",ellipsis:!0,textColor:"neutral800",children:e.jsx(W,{type:s.type,value:t})})}},Ct=(t,n,s)=>{if(s.type==="component"){if(s.repeatable||!n)return t?.length>0;const a=t?.[n.name];return n.name==="id"&&![void 0,null].includes(a)?!0:!z(a)}return s.type==="relation"?je(s.relation)?!z(t):Array.isArray(t)?t.length>0:t?.count>0:["integer","decimal","float","number"].includes(s.type)?typeof t=="number":s.type==="boolean"?t!==null:!z(t)},je=t=>["oneToOne","manyToOne","oneToOneMorph"].includes(t),re=t=>{const n=ct(d=>d.admin_app.permissions.contentManager?.collectionTypesConfigurations??[]),[{query:s}]=D(),{formatMessage:a}=k(),{allowedActions:{canConfigureView:c}}=me(n);return e.jsxs(G.Root,{children:[e.jsx(G.Trigger,{children:e.jsx(ve,{label:a({id:"components.ViewSettings.tooltip",defaultMessage:"View Settings"}),children:e.jsx(Pe,{})})}),e.jsx(G.Content,{side:"bottom",align:"end",sideOffset:4,children:e.jsxs(O,{alignItems:"stretch",direction:"column",padding:3,gap:3,children:[c?e.jsx(Oe,{size:"S",startIcon:e.jsx($e,{}),variant:"secondary",tag:Be,to:{pathname:"configurations/list",search:s.plugins?_.stringify({plugins:s.plugins},{encode:!1}):""},children:a({id:"app.links.configure-view",defaultMessage:"Configure the view"})}):null,e.jsx(St,{...t})]})})]})},St=({headers:t=[],resetHeaders:n,setHeaders:s})=>{const{trackUsage:a}=q(),{formatMessage:c,locale:d}=k(),{schema:x,model:g}=J(),{list:i}=pe(g),m=de(d,{sensitivity:"base"}),j=x?.attributes??{},A=Object.keys(j).filter(u=>De(j[u])).map(u=>({name:u,label:i.metadatas[u]?.label??""})).sort((u,o)=>m.compare(u.label,o.label)),y=u=>{a("didChangeDisplayedFields");const o=t.includes(u)?t.filter(I=>I!==u):[...t,u];s(o)},C=()=>{n()};return e.jsxs(O,{tag:"fieldset",direction:"column",alignItems:"stretch",gap:1,borderWidth:0,maxHeight:"240px",padding:1,overflow:"auto",children:[e.jsxs(O,{justifyContent:"space-between",gap:2,children:[e.jsx(L,{tag:"legend",variant:"pi",fontWeight:"bold",children:c({id:"containers.list.displayedFields",defaultMessage:"Displayed fields"})}),e.jsx(Ne,{onClick:C,children:c({id:"app.components.Button.reset",defaultMessage:"Reset"})})]}),e.jsx(O,{direction:"column",alignItems:"stretch",children:A.map(u=>{const o=t.includes(u.name);return e.jsx(O,{wrap:"wrap",gap:2,background:o?"primary100":"transparent",hasRadius:!0,padding:2,marginBottom:1,children:e.jsx(Ue,{onCheckedChange:()=>y(u.name),checked:o,name:u.name,children:e.jsx(L,{fontSize:1,children:u.label})})},u.name)})})]})},{INJECT_COLUMN_IN_TABLE:Mt}=Ye,oe=X(N.Header)`
  overflow-wrap: anywhere;
`,Lt=()=>{const{trackUsage:t}=q(),n=He(),{formatMessage:s}=k(),{toggleNotification:a}=Ve(),{_unstableFormatAPIError:c}=_e(v),{collectionType:d,model:x,schema:g}=J(),{list:i}=pe(x),[m,j]=M.useState([]),A=he(i.layout);M.useEffect(()=>{We(A,i.layout)||j(i.layout)},[i.layout,A]);const y=r=>{j(rt(r,g.attributes,i.metadatas))},[{query:C}]=D({page:"1",pageSize:i.settings.pageSize.toString(),sort:i.settings.defaultSortBy?`${i.settings.defaultSortBy}:${i.settings.defaultSortOrder}`:""}),u=M.useMemo(()=>qe(C),[C]),{data:o,error:I,isFetching:B}=ze({model:x,params:u});M.useEffect(()=>{I&&a({type:"danger",message:c(I)})},[I,c,a]);const{results:P=[],pagination:T}=o??{};M.useEffect(()=>{T&&T.pageCount>0&&T.page>T.pageCount&&n({search:_.stringify({...C,page:T.pageCount})},{replace:!0})},[T,s,C,n]);const{canCreate:$}=Ge("ListViewPage",({canCreate:r})=>({canCreate:r})),p=Qe("ListViewPage",({runHookWaterfall:r})=>r),E=M.useMemo(()=>{const S=p(Mt,{displayedHeaders:m,layout:i}).displayedHeaders.map(l=>{const F=typeof l.label=="string"?{id:`content-manager.content-types.${x}.${l.name}`,defaultMessage:l.label}:l.label;return{...l,label:s(F),name:`${l.name}${l.mainField?.name?`.${l.mainField.name}`:""}`}});return g?.options?.draftAndPublish&&S.push({attribute:{type:"custom"},name:"status",label:s({id:v("containers.list.table-headers.status"),defaultMessage:"status"}),searchable:!1,sortable:!1}),S},[m,s,i,p,g?.options?.draftAndPublish,x]);if(B)return e.jsx(w.Loading,{});if(I)return e.jsx(w.Error,{});const h=g?.info.displayName?s({id:g.info.displayName,defaultMessage:g.info.displayName}):s({id:"content-manager.containers.untitled",defaultMessage:"Untitled"}),f=r=>()=>{t("willEditEntryFromList"),n({pathname:r.toString(),search:_.stringify({plugins:C.plugins})})};return!B&&P.length===0?e.jsxs(e.Fragment,{children:[e.jsx(H.contentManager.Introduction,{children:e.jsx(Q,{})}),e.jsxs(w.Main,{children:[e.jsx(w.Title,{children:`${h}`}),e.jsx(oe,{primaryAction:$?e.jsx(H.contentManager.CreateNewEntry,{children:e.jsx(V,{})}):null,subtitle:s({id:v("pages.ListView.header-subtitle"),defaultMessage:"{number, plural, =0 {# entries} one {# entry} other {# entries}} found"},{number:T?.total}),title:h,navigationAction:e.jsx(te,{})}),e.jsx(N.Action,{endActions:e.jsxs(e.Fragment,{children:[e.jsx(se,{area:"listView.actions"}),e.jsx(re,{setHeaders:y,resetHeaders:()=>j(i.layout),headers:m.map(r=>r.name)})]}),startActions:e.jsxs(e.Fragment,{children:[i.settings.searchable&&e.jsx(ne,{label:s({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:h}),placeholder:s({id:"global.search",defaultMessage:"Search"}),trackedEvent:"didSearch"}),i.settings.filterable&&g?e.jsx(ie,{schema:g}):null]})}),e.jsx(N.Content,{children:e.jsx(Q,{background:"neutral0",shadow:"filterShadow",hasRadius:!0,children:e.jsx(Ze,{action:$?e.jsx(V,{variant:"secondary"}):null,content:s({id:"app.components.EmptyStateLayout.content-document",defaultMessage:"No content found"}),hasRadius:!0,icon:e.jsx(Ke,{width:"16rem"})})})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(H.contentManager.Introduction,{children:e.jsx(Q,{})}),e.jsxs(w.Main,{children:[e.jsx(w.Title,{children:`${h}`}),e.jsx(oe,{primaryAction:$?e.jsx(H.contentManager.CreateNewEntry,{children:e.jsx(V,{})}):null,subtitle:s({id:v("pages.ListView.header-subtitle"),defaultMessage:"{number, plural, =0 {# entries} one {# entry} other {# entries}} found"},{number:T?.total}),title:h,navigationAction:e.jsx(te,{})}),e.jsx(N.Action,{endActions:e.jsxs(e.Fragment,{children:[e.jsx(se,{area:"listView.actions"}),e.jsx(re,{setHeaders:y,resetHeaders:()=>j(i.layout),headers:m.map(r=>r.name)})]}),startActions:e.jsxs(e.Fragment,{children:[i.settings.searchable&&e.jsx(ne,{disabled:P.length===0,label:s({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:h}),placeholder:s({id:"global.search",defaultMessage:"Search"}),trackedEvent:"didSearch"}),i.settings.filterable&&g?e.jsx(ie,{disabled:P.length===0,schema:g}):null]})}),e.jsx(N.Content,{children:e.jsxs(O,{gap:4,direction:"column",alignItems:"stretch",children:[e.jsxs(b.Root,{rows:P,headers:E,isLoading:B,children:[e.jsx(Tt,{}),e.jsxs(b.Content,{children:[e.jsxs(b.Head,{children:[e.jsx(b.HeaderCheckboxCell,{}),E.map(r=>e.jsx(b.HeaderCell,{...r},r.name))]}),e.jsx(b.Loading,{}),e.jsx(b.Empty,{action:$?e.jsx(V,{variant:"secondary"}):null}),e.jsx(b.Body,{children:P.map(r=>e.jsxs(b.Row,{cursor:"pointer",onClick:f(r.documentId),children:[e.jsx(b.CheckboxCell,{id:r.id}),E.map(({cellFormatter:S,...l})=>{if(l.name==="status"){const{status:F}=r;return e.jsx(b.Cell,{children:e.jsx(Xe,{status:F,maxWidth:"min-content"})},l.name)}return["createdBy","updatedBy"].includes(l.name.split(".")[0])?e.jsx(b.Cell,{children:e.jsx(L,{textColor:"neutral800",children:r[l.name.split(".")[0]]?Z(r[l.name.split(".")[0]]):"-"})},l.name):typeof S=="function"?e.jsx(b.Cell,{children:S(r,l,{collectionType:d,model:x})},l.name):e.jsx(b.Cell,{children:e.jsx(bt,{content:r[l.name.split(".")[0]],rowId:r.documentId,...l})},l.name)}),e.jsx(At,{onClick:S=>S.stopPropagation(),children:e.jsx(Je,{document:r})})]},r.id))})]})]}),e.jsxs(Y.Root,{...T,onPageSizeChange:()=>t("willChangeNumberOfEntriesPerPage"),children:[e.jsx(Y.PageSize,{}),e.jsx(Y.Links,{})]})]})})]})]})},At=X(b.Cell)`
  display: flex;
  justify-content: flex-end;
`,Tt=()=>{const t=ot("TableActionsBar",c=>c.selectRow),[{query:n}]=D(),s=n?.plugins?.i18n?.locale,a=he(s);return M.useEffect(()=>{a!==s&&t([])},[t,a,s]),e.jsx(b.ActionBar,{children:e.jsx(lt,{})})},V=({variant:t})=>{const{formatMessage:n}=k(),{trackUsage:s}=q(),[{query:a}]=D();return e.jsx(nt,{variant:t,tag:at,onClick:()=>{s("willCreateEntry",{status:"draft"})},startIcon:e.jsx(it,{}),style:{textDecoration:"none"},to:{pathname:"create",search:_.stringify({plugins:a.plugins})},minWidth:"max-content",marginLeft:2,children:n({id:v("HeaderLayout.button.label-add-entry"),defaultMessage:"Create new entry"})})},Ft=()=>{const{slug:t=""}=et(),{permissions:n=[],isLoading:s,error:a}=me(tt.map(c=>({action:c,subject:t})));return s?e.jsx(w.Loading,{}):a||!t?e.jsx(w.Error,{}):e.jsx(w.Protect,{permissions:n,children:({permissions:c})=>e.jsx(st,{permissions:c,children:e.jsx(Lt,{})})})};export{Lt as ListViewPage,Ft as ProtectedListViewPage};
