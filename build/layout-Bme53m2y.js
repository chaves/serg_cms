import{j as e,aS as k,e as H,f as h,fF as Y,k as z,cH as N,fG as V,h as B,n as W,fH as Z,fI as q,aa as J,fJ as X,m as ee,B as te,aD as se,fK as ne,aT as _,A as ae,aZ as x,ah as ie,aW as re,r as b,fL as oe,fM as le,fN as ce,b9 as v,fO as de,fP as ue,u as pe,fQ as ge,fR as fe,fS as he,dL as f,dI as A,fT as me,fU as ye,b3 as xe,dN as Te,b7 as je,P as D,b8 as w,K as Le,dO as be,fV as M}from"./strapi-CDBlFoOX.js";import{u as Ce}from"./useDragLayer-Do23OFD7.js";import{C as Se}from"./CardDragPreview-Bq8mbohf.js";import{a as Me,u as F}from"./hooks-DlOupo1V.js";function Ie(s,n,r){if(!s||!n||!r)return{display:"none"};const{x:t,y:o}=r;return{transform:`translate(${t}px, ${o}px)`}}const De=({renderItem:s})=>{const{itemType:n,isDragging:r,item:t,initialOffset:o,currentOffset:u,mouseOffset:p}=Ce(i=>({item:i.getItem(),itemType:i.getItemType(),initialOffset:i.getInitialSourceClientOffset(),currentOffset:i.getSourceClientOffset(),isDragging:i.isDragging(),mouseOffset:i.getClientOffset()}));return r?e.jsx(k,{height:"100%",left:0,position:"fixed",pointerEvents:"none",top:0,zIndex:100,width:"100%",children:e.jsx(k,{style:Ie(o,u,p),children:s({type:n,item:t})})}):null},ke=({displayedValue:s})=>{const n=H();return e.jsxs(h,{background:"neutral0",borderColor:"neutral200",justifyContent:"space-between",gap:3,padding:3,width:"30rem",children:[e.jsx(Pe,{type:"button",children:e.jsxs(h,{gap:6,children:[e.jsx(Ee,{alignItems:"center",justifyContent:"center",background:"neutral200",height:"3.2rem",width:"3.2rem",children:e.jsx(Y,{})}),e.jsx(h,{maxWidth:"15rem",children:e.jsx(z,{textColor:"neutral700",ellipsis:!0,children:s})})]})}),e.jsxs(h,{gap:2,children:[e.jsx(N,{withTooltip:!1,label:"",variant:"ghost",children:e.jsx(V,{})}),n&&e.jsx(N,{withTooltip:!1,label:"",variant:"ghost",children:e.jsx(B,{})})]})]})},Ee=W(h)`
  border-radius: 50%;

  svg {
    height: 0.6rem;
    width: 1.1rem;
    > path {
      fill: ${({theme:s})=>s.colors.neutral600};
    }
  }
`,Pe=W.button`
  border: none;
  background: transparent;
  display: block;
  width: 100%;
  text-align: unset;
  padding: 0;
`,Oe=({status:s,displayedValue:n,width:r})=>{const t=H();return e.jsx(k,{style:{width:r},children:e.jsxs(h,{paddingTop:2,paddingBottom:2,paddingLeft:2,paddingRight:4,hasRadius:!0,borderWidth:1,background:"neutral0",borderColor:"neutral200",justifyContent:"space-between",gap:4,children:[e.jsxs(Z,{gap:1,children:[t&&e.jsx(N,{withTooltip:!1,label:"",variant:"ghost",children:e.jsx(B,{})}),e.jsxs(h,{width:"100%",minWidth:0,justifyContent:"space-between",children:[e.jsx(k,{minWidth:0,paddingTop:1,paddingBottom:1,paddingRight:4,children:e.jsx(q,{href:"",children:e.jsx(z,{textColor:"primary600",ellipsis:!0,children:n})})}),s?e.jsx(J,{status:s}):null]})]}),e.jsx(X,{type:"button",children:e.jsx(ee,{width:"12px"})})]})})},{MUTATE_COLLECTION_TYPES_LINKS:we,MUTATE_SINGLE_TYPES_LINKS:Ne}=le,Q=()=>{const{toggleNotification:s}=te(),n=Me(),r=se("useContentManagerInitData",g=>g.runHookWaterfall),{notifyStatus:t}=ne(),{formatMessage:o}=_(),{_unstableFormatAPIError:u}=ae(x),p=ie("useContentManagerInitData",g=>g.checkUserHasPermissions),i=F(g=>g["content-manager"].app),a=re(void 0,{refetchOnMountOrArgChange:!0});b.useEffect(()=>{a.data&&t(o({id:x("App.schemas.data-loaded"),defaultMessage:"The schemas have been successfully loaded."}))},[o,a.data,t]),b.useEffect(()=>{a.error&&s({type:"danger",message:u(a.error)})},[u,a.error,s]);const d=oe();b.useEffect(()=>{d.error&&s({type:"danger",message:u(d.error)})},[u,d.error,s]);const m=async(g,j,E,P)=>{const{collectionType:T,singleType:O}=j.reduce((y,L)=>(y[L.kind].push(L),y),{collectionType:[],singleType:[]}),l=R(T,"collectionTypes",P),c=R(O,"singleTypes"),C=await Promise.all(l.map(({permissions:y})=>p(y))),S=l.filter((y,L)=>C[L].length>0),I=await Promise.all(c.map(({permissions:y})=>p(y))),G=c.filter((y,L)=>I[L].length>0),{ctLinks:K}=r(we,{ctLinks:S,models:j}),{stLinks:U}=r(Ne,{stLinks:G,models:j});n(ce({authorizedCollectionTypeLinks:K,authorizedSingleTypeLinks:U,components:g,contentTypeSchemas:j,fieldSizes:E}))};return b.useEffect(()=>{a.data&&d.data&&m(a.data.components,a.data.contentTypes,a.data.fieldSizes,d.data)},[a.data,d.data]),{...i}},R=(s,n,r=[])=>s.filter(t=>t.isDisplayed).map(t=>{const o=[{action:"plugin::content-manager.explorer.create",subject:t.uid},{action:"plugin::content-manager.explorer.read",subject:t.uid}],u=[{action:"plugin::content-manager.explorer.read",subject:t.uid}],p=n==="collectionTypes"?o:u,i=r.find(({uid:d})=>d===t.uid);let a=null;if(i){const d={page:1,pageSize:i.settings.pageSize,sort:`${i.settings.defaultSortBy}:${i.settings.defaultSortOrder}`};a=v.stringify(d,{encode:!1})}return{permissions:p,search:a,kind:t.kind,title:t.info.displayName,to:`/content-manager/${t.kind==="collectionType"?de:ue}/${t.uid}`,uid:t.uid,name:t.uid,isDisplayed:t.isDisplayed}}),$=({isFullPage:s=!1})=>{const[n,r]=b.useState(""),[{query:t}]=pe(),{formatMessage:o,locale:u}=_(),{isLoading:p}=Q(),i=F(l=>l["content-manager"].app.collectionTypeLinks),a=F(l=>l["content-manager"].app.singleTypeLinks),{schemas:d}=ge(),{contains:m}=fe(u,{sensitivity:"base"}),g=he(u,{sensitivity:"base"}),j=b.useMemo(()=>[{id:"collectionTypes",title:o({id:x("components.LeftMenu.collection-types"),defaultMessage:"Collection Types"}),searchable:!0,links:i},{id:"singleTypes",title:o({id:x("components.LeftMenu.single-types"),defaultMessage:"Single Types"}),searchable:!0,links:a}].map(l=>({...l,links:l.links.filter(c=>m(c.title,n.trim())).sort((c,C)=>g.compare(c.title,C.title)).map(c=>({...c,title:o({id:c.title,defaultMessage:c.title})}))})),[i,n,a,m,o,g]),E=()=>{r("")},P=l=>{r(l.target.value)},T=o({id:x("header.name"),defaultMessage:"Content Manager"}),O=l=>{const C=!!d.find(S=>S.uid===l.uid)?.pluginOptions?.i18n?.localized;if(t.plugins&&"i18n"in t.plugins){const{i18n:S,...I}=t.plugins;return C?{i18n:S,...I}:I}return t.plugins};return p?e.jsxs(f.Main,{"aria-label":T,children:[e.jsx(f.Header,{label:T}),e.jsx(A,{}),e.jsx(h,{padding:4,justifyContent:"center",children:e.jsx(me,{})})]}):e.jsxs(f.Main,{"aria-label":T,children:[!s&&e.jsxs(e.Fragment,{children:[e.jsx(f.Header,{label:T}),e.jsx(A,{})]}),e.jsxs(f.Content,{children:[s&&e.jsx(f.Header,{label:T}),e.jsx(h,{paddingLeft:{initial:4,large:5},paddingRight:{initial:4,large:5},paddingTop:s?0:{initial:4,large:5},paddingBottom:0,gap:3,direction:"column",alignItems:"stretch",children:e.jsx(ye,{value:n,onChange:P,onClear:E,placeholder:o({id:"search.placeholder",defaultMessage:"Search"}),size:"S",children:void 0,name:"search_contentType",clearLabel:o({id:"clearLabel",defaultMessage:"Clear"})})}),e.jsx(f.Sections,{children:j.map(l=>e.jsx(f.Section,{label:l.title,badgeLabel:l.links.length.toString(),children:l.links.map(c=>e.jsx(f.Link,{to:{pathname:c.to,search:v.stringify({...v.parse(c.search??""),plugins:O(c)})},label:c.title},c.uid))},l.id))})]})]})},$e=()=>{const s=xe("/content-manager/:kind/:uid/*"),n=Te(),{isLoading:r,collectionTypeLinks:t,models:o,singleTypeLinks:u}=Q(),p=[...t,...u].sort((m,g)=>m.title.localeCompare(g.title)),{pathname:i}=je(),{formatMessage:a}=_();if(r)return e.jsxs(e.Fragment,{children:[e.jsx(D.Title,{children:a({id:x("plugin.name"),defaultMessage:"Content Manager"})}),e.jsx(D.Loading,{})]});const d=o.filter(({isDisplayed:m})=>m);return p.length===0&&d.length>0&&i!=="/content-manager/403"?e.jsx(w,{to:"/403"}):d.length===0&&i!=="/no-content-types"?e.jsx(w,{to:"/no-content-types"}):!s&&p.length>0?n?e.jsxs(e.Fragment,{children:[e.jsx(D.Title,{children:a({id:x("plugin.name"),defaultMessage:"Content Manager"})}),e.jsx(f.PageWrapper,{children:e.jsx($,{isFullPage:!0})})]}):e.jsx(w,{to:{pathname:p[0].to,search:p[0].search??""},replace:!0}):e.jsxs(e.Fragment,{children:[e.jsx(D.Title,{children:a({id:x("plugin.name"),defaultMessage:"Content Manager"})}),e.jsxs(Le.Root,{sideNav:e.jsx($,{}),children:[e.jsx(De,{renderItem:ve}),e.jsx(be,{})]})]})};function ve({type:s,item:n}){if(!s||s&&typeof s!="string")return null;const[r]=s.split("_");switch(r){case M.EDIT_FIELD:case M.FIELD:return e.jsx(Se,{label:n.label});case M.COMPONENT:case M.DYNAMIC_ZONE:return e.jsx(ke,{displayedValue:n.displayedValue});case M.RELATION:return e.jsx(Oe,{...n});default:return null}}export{$e as Layout};
